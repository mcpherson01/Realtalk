/*Minified*/
(function(a){a.widget("cp.UseyourDriveDashboard",{options:{$container_totals:a("#useyourdrive-totals"),$container_events_chart:a("#useyourdrive-events-chart"),$container_top_downloads:a("#top-downloads"),$container_top_users:a("#top-users"),$container_full_log:a("#full-log")},_create:function(){this._initiate()},_destroy:function(){return this._super()},_setOption:function(b,c){this._super(b,c)},_initiate:function(){var b=this;a("body").addClass("useyourdrive");this._initChartDatePicker();this.options.$container_totals.one("inview",function(d,c){b.loadTotalsData(b.options.$container_totals,null,null)});this.options.$container_events_chart.one("inview",function(d,c){b.loadChartData()});this.options.$container_top_downloads.one("inview",function(d,c){b.loadTopDownloads()});this.options.$container_top_users.one("inview",function(d,c){b.loadTopUsers()});this.options.$container_full_log.one("inview",function(d,c){b.loadFullLog()});this._initEvents()},_initEvents:function(){var b=this;a(b.element).on("click","a.open-entry-details",function(d){var f=a(this).data("entry-id");var c=a(this).data("account-id");b.viewEntryDetails(f,c)});a("body").on("click","#useyourdrive-modal-action a.open-entry-details",function(d){var f=a(this).data("entry-id");var c=a(this).data("account-id");b.viewEntryDetails(f,c)});a(b.element).on("click","a.open-user-details",function(c){var d=a(this).data("user-id");b.viewUserDetails(d)});a("body").on("click","#useyourdrive-modal-action a.open-user-details",function(c){var d=a(this).data("user-id");b.viewUserDetails(d)});a(b.element).on("click","#clear_statistics",function(c){b.clearStatistics()})},clearStatistics:function(){var b=this;var c=a("#clear_statistics");c.addClass("disabled");c.find(".uyd-spinner").fadeIn();a.ajax({method:"POST",url:b.options.ajax_url,data:{action:"useyourdrive-reset-statistics",_ajax_nonce:b.options.admin_nonce},complete:function(){c.removeClass("disabled");c.find(".uyd-spinner").fadeOut();location.reload(true)},dataType:"json"})},_initChartDatePicker:function(){var b=this;var c=b.element.find(".chart_datepicker_from");var d=b.element.find(".chart_datepicker_to");b.chart_datepicker_from=c.datepicker({altField:".chart_datepicker_from",autoSize:true,dateFormat:"dd-mm-yy",changeMonth:true}).on("change",function(){b.chart_datepicker_to.datepicker("option","minDate",moment(c.datepicker("getDate")).format("DD-MM-YYYY"));clearTimeout(b.updateChartTimer);b.updateChartTimer=setTimeout(function(){b.loadChartData();b.fullLog.ajax.reload()},1000)});c.datepicker("setDate",moment().subtract(1,"months").toDate());b.chart_datepicker_to=d.datepicker({altField:".chart_datepicker_to",autoSize:true,dateFormat:"dd-mm-yy",changeMonth:true,maxDate:"+0d"}).on("change",function(){b.chart_datepicker_from.datepicker("option","maxDate",moment(d.datepicker("getDate")).format("DD-MM-YYYY"));clearTimeout(b.updateChartTimer);b.updateChartTimer=setTimeout(function(){b.loadChartData();b.fullLog.ajax.reload()},1000)});d.datepicker("setDate",moment().toDate())},loadChartData:function(){var b=this;b.options.$container_events_chart.prev().fadeIn();a.ajax({method:"POST",url:b.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"activities",periodstart:moment(b.chart_datepicker_from.datepicker("getDate")).format("YYYY-MM-DD"),periodend:moment(b.chart_datepicker_to.datepicker("getDate")).format("YYYY-MM-DD"),_ajax_nonce:b.options.admin_nonce},success:function(c){b._setChart(c)},complete:function(c){b.options.$container_events_chart.prev().fadeOut()},dataType:"json"})},_setChart:function(c){var b=this;new Chart(b.options.$container_events_chart,{type:"line",options:{responsive:true,maintainAspectRatio:false,legend:{position:"bottom"},tooltips:{mode:"x"},scales:{xAxes:[{type:"time",time:{parser:"DD-MM-YYYY",unit:"day",tooltipFormat:"LL"},scaleLabel:{display:false},ticks:{beginAtZero:false}}],yAxes:[{scaleLabel:{display:false},ticks:{beginAtZero:true}}]}},data:c})},loadTotalsData:function(d,c,e){var b=this;d.find(".useyourdrive-counter span").css({"background-color":"",color:""});a.ajax({method:"POST",url:b.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"totals",detail:c,id:e,_ajax_nonce:b.options.admin_nonce},success:function(f){b._setTotalsData(d,f)},complete:function(f){d.find(".loading").fadeOut()},dataType:"json"})},_setTotalsData:function(d,c){var b=this;a.each(d.find(".useyourdrive-counter"),function(){var f=a(this).data("type");if(typeof c[f]==="undefined"){a(this).find("span").append("0");return true}var e=parseInt(c[f].total);a(this).find("span").css({"background-color":c[f].colors.normal,color:"white"}).append(e)})},loadTopDownloads:function(){var b=this;b.options.$container_top_downloads.DataTable({dom:'<"top">rt<"bottom">p<"clear">',language:{loadingRecords:"",processing:'<div class="loading"><div class="loader-beat"></div></div>'},searching:false,autoWidth:true,scrollY:"300px",paging:false,deferRender:true,responsive:{details:{type:"column",target:-1}},columns:[{data:"icon"},{data:"entry_name"},{data:"total"}],columnDefs:[{name:"icon",targets:0,width:"20px",className:"all",responsivePriority:4,searchable:false,orderable:false,render:function(e,d,c,f){if(d!=="display"){return e}return'<a href="#'+c.entry_id+'"><img src="'+e+'" width="24px" height="24px"/></a>'}},{name:"entry_name",targets:1,className:"all",responsivePriority:1,render:function(e,d,c,f){if(d!=="display"){return e}return'<a href="#'+c.entry_id+'" title="'+c.parent_path+"/"+c.entry_name+'" class="open-entry-details" data-entry-id="'+c.entry_id+'">'+c.entry_name+"</a>"}},{name:"total",targets:2,width:"30px",className:"dt-right",render:function(e,d,c,f){if(d!=="display"){return e}return e}}],order:[[2,"desc"]],processing:true,serverSide:true,ajax:{url:b.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"topdownloads",_ajax_nonce:b.options.admin_nonce}}})},loadTopUsers:function(){var b=this;b.options.$container_top_users.DataTable({dom:'<"top">rt<"bottom">p<"clear">',language:{loadingRecords:"",processing:'<div class="loading"><div class="loader-beat"></div></div>'},searching:false,autoWidth:true,scrollY:"300px",paging:false,deferRender:true,responsive:{details:{type:"column",target:-1}},columns:[{data:"icon"},{data:"user_display_name"},{data:"user_name"},{data:"total"}],columnDefs:[{name:"icon",targets:0,width:"20px",className:"all",responsivePriority:4,searchable:false,orderable:false,render:function(e,d,c,f){if(d!=="display"){return e}return'<a href="#'+c.user_id+'" class="open-user-details" data-user-id="'+c.user_id+'" ><img src="'+e+'" width="24px" height="24px"/></a>'}},{name:"user_display_name",targets:1,className:"all",responsivePriority:1,render:function(e,d,c,f){if(d!=="display"){return e}if(c.user_id==="0"){return e}return'<a href="#'+c.user_id+'" class="open-user-details" data-user-id="'+c.user_id+'">'+e+"</a>"}},{name:"user_name",targets:2,className:"dt-left",render:function(e,d,c,f){if(d!=="display"){return e}if(c.user_id==="0"){return e}return'<a href="#'+c.user_id+'" class="open-user-details"  data-user-id="'+c.user_id+'">'+e+"</a>"}},{name:"total",targets:3,width:"30px",className:"dt-right",render:function(e,d,c,f){if(d!=="display"){return e}return e}}],order:[[3,"desc"]],processing:true,serverSide:true,ajax:{url:b.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"topusers",_ajax_nonce:b.options.admin_nonce}}})},loadFullLog:function(){var b=this;b.fullLog=b.options.$container_full_log.DataTable({dom:'fBrtip<"clear">',language:{loadingRecords:'<div class="loading"><div class="loader-beat"></div></div>',processing:'<div class="loading"><div class="loader-beat"></div></div>'},autoWidth:true,deferRender:true,scrollY:500,scroller:true,scrollCollapse:true,pageLength:50,searchDelay:600,buttons:[{text:'<i class="fas fa-file-export fa-lg"></i>',className:"simple-button blue",action:function(g,f,d,c){a.ajax({url:b.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"full-log","export":true,periodstart:moment(b.chart_datepicker_from.datepicker("getDate")).format("YYYY-MM-DD"),periodend:moment(b.chart_datepicker_to.datepicker("getDate")).format("YYYY-MM-DD"),_ajax_nonce:b.options.admin_nonce},success:function(h,e,k){var l=new Blob([h],{type:"text/csv;charset=utf-8;"});var j=window.URL.createObjectURL(l);var i=document.createElement("a");i.href=j;i.setAttribute("download","data.csv");i.click()}})}},{extend:"copy",text:'<i class="fas fa-copy fa-lg"></i>',className:"simple-button blue"},{extend:"print",text:'<i class="fas fa-print fa-lg"></i>',className:"simple-button blue",title:""},{extend:"colvis",text:'<i class="fas fa-filter fa-lg"></i>',className:"simple-button blue",background:false,columns:[1,2,3,4,5,6,7,8]}],columns:[{data:"icon"},{data:"description"},{data:"datetime"},{data:"type"},{data:"user"},{data:"entry_name"},{data:"parent_path"},{data:"location"},{data:"extra"}],columnDefs:[{name:"icon",targets:0,orderable:false,width:"24px",className:"dt-left all",searchable:false,render:function(e,d,c,f){if(d!=="display"){return e}return"<i class='fas "+e+" fa-lg'></i>"}},{name:"description",targets:1,className:"dt-left",searchable:false,render:function(e,d,c,f){if(d!=="display"){return e}return e}},{name:"datetime",targets:2,width:"150px",className:"dt-left all",render:function(e,d,c,f){if(d!=="display"){return e}return e}},{name:"type",targets:3,className:"all",visible:false,render:function(e,d,c,f){if(d!=="display"){return e}return e}},{name:"user",targets:4,className:"dt-left",visible:false,render:function(e,d,c,f){if(d!=="display"){return e}return'<a href="#'+c.user_id+'" class="open-user-details"  data-user-id="'+c.user_id+'">'+e+"</a>"}},{name:"entry_name",targets:5,className:"dt-left",visible:false,render:function(e,d,c,f){if(d!=="display"){return e}return e}},{name:"parent_path",targets:6,className:"dt-left",visible:false,render:function(e,d,c,f){if(d!=="display"){return e}return e}},{name:"location",targets:7,className:"dt-left",visible:false,render:function(e,d,c,f){if(d!=="display"){return e}if(e===""){return""}return'<a href="'+c.location_full+'" target="_blank"><i class="fas fa-external-link-alt"></i> '+e+"</a>"}},{name:"extra",targets:8,className:"dt-left",visible:false,render:function(e,d,c,f){if(d!=="display"){return e}return e}}],order:[[2,"desc"]],processing:true,serverSide:true,ajax:{url:b.options.ajax_url,data:function(c){c.action="useyourdrive-event-stats";c.type="full-log";c.periodstart=moment(b.chart_datepicker_from.datepicker("getDate")).format("YYYY-MM-DD");c.periodend=moment(b.chart_datepicker_to.datepicker("getDate")).format("YYYY-MM-DD");c._ajax_nonce=b.options.admin_nonce}}})},loadDetailedLog:function(c,d,e){var b=this;c.DataTable({dom:'fBrtip<"clear">',language:{loadingRecords:'<div class="loading"><div class="loader-beat"></div></div>',processing:'<div class="loading"><div class="loader-beat"></div></div>'},autoWidth:true,deferRender:true,scrollY:300,scroller:true,pageLength:50,searchDelay:600,responsive:true,buttons:[{text:'<i class="fas fa-file-export fa-lg"></i>',className:"simple-button blue",action:function(i,h,g,f){a.ajax({url:b.options.ajax_url,data:{action:"useyourdrive-event-stats",type:"full-log",detail:d,id:e,"export":true,_ajax_nonce:b.options.admin_nonce},success:function(k,j,n){var o=new Blob([k],{type:"text/csv;charset=utf-8;"});var m=window.URL.createObjectURL(o);var l=document.createElement("a");l.href=m;l.setAttribute("download","data.csv");l.click()}})}},{extend:"copy",text:'<i class="fas fa-copy fa-lg"></i>',className:"simple-button blue"},{extend:"print",text:'<i class="fas fa-print fa-lg"></i>',className:"simple-button blue",title:""},{extend:"colvis",text:'<i class="fas fa-filter fa-lg"></i>',className:"simple-button blue",background:false,columns:[1,2,3,4,5,6,7,8]}],columns:[{data:"icon"},{data:"description"},{data:"datetime"},{data:"type"},{data:"user"},{data:"entry_name"},{data:"parent_path"},{data:"location"},{data:"extra"}],columnDefs:[{name:"icon",targets:0,orderable:false,width:"24px",className:"dt-left all",searchable:false,render:function(h,g,f,i){if(g!=="display"){return h}return"<i class='fas "+h+" fa-lg'></i>"}},{name:"description",targets:1,className:"dt-left",searchable:false,render:function(h,g,f,i){if(g!=="display"){return h}return h}},{name:"datetime",targets:2,width:"150px",className:"dt-left all",render:function(h,g,f,i){if(g!=="display"){return h}return h}},{name:"type",targets:3,className:"all",visible:false,render:function(h,g,f,i){if(g!=="display"){return h}return h}},{name:"user",targets:4,className:"dt-left",visible:false,render:function(h,g,f,i){if(g!=="display"){return h}return'<a href="#'+f.user_id+'" class="open-user-details"  data-user-id="'+f.user_id+'">'+h+"</a>"}},{name:"entry_name",targets:5,className:"dt-left",visible:false,render:function(h,g,f,i){if(g!=="display"){return h}return h}},{name:"parent_path",targets:6,className:"dt-left",visible:false,render:function(h,g,f,i){if(g!=="display"){return h}return h}},{name:"location",targets:7,className:"dt-left",visible:false,render:function(h,g,f,i){if(g!=="display"){return h}if(h===""){return""}return'<a href="'+f.location_full+'" target="_blank"><i class="fas fa-external-link-alt"></i>'+h+"</a>"}},{name:"extra",targets:8,className:"dt-left",visible:false,render:function(h,g,f,i){if(g!=="display"){return h}return h}}],order:[[2,"desc"]],processing:true,serverSide:true,ajax:b.options.ajax_url+"?action=useyourdrive-event-stats&type=full-log&detail="+d+"&id="+e+"&_ajax_nonce="+b.options.admin_nonce})},viewEntryDetails:function(d,c){var b=this;b.openModal("entry",d,c)},viewUserDetails:function(c){var b=this;b.openModal("user",c,null)},openModal:function(j,f,m){var n=this;a("#useyourdrive-modal-action").remove();var k="";k+='<button class="simple-button blue useyourdrive-modal-cancel-btn secondary" data-action="cancel" type="button" onclick="modal_action.close();" title="'+n.options.str_close_title+'" >'+n.options.str_close_title+"</button>";var d=a('<a tabindex="0" class="close-button" title="'+n.options.str_close_title+'" onclick="modal_action.close();"><i class="fas fa-times fa-lg" aria-hidden="true"></i></a></div>');var i=a('<div class="useyourdrive-modal-body" tabindex="0" style="display:none"></div>');var h=a('<div class="useyourdrive-modal-footer" style="display:none"><div class="useyourdrive-modal-buttons">'+k+"</div></div>");var g=a('<div id="useyourdrive-modal-action" class="UseyourDrive useyourdrive-modal useyourdrive-modal80 '+n.options.content_skin+'"><div class="modal-dialog"><div class="modal-content"><div class="loading"><div class="loader-beat"></div></div></div></div></div>');a("body").append(g);var c=a(".event-details-template").clone().appendTo(i).show();a("#useyourdrive-modal-action .modal-content").append(d,i,h);switch(j){case"user":var l=a(".modal-content  .event-details-user-template").show();break;case"entry":var l=a(".modal-content  .event-details-entry-template").show();break}var e=a(".modal-content .event-details-totals-template");e.find("span").html('<div class="loading"><div class="loader-beat"></div></div>');n.loadTotalsData(e,j,f);a.ajax({type:"POST",url:n.options.ajax_url,data:{action:"useyourdrive-event-stats",account_id:m,type:"get-detail",detail:j,id:f,_ajax_nonce:n.options.admin_nonce},success:function(o){switch(j){case"user":c.find(".event-details-name").text(o.user.user_name);l.find(".event-details-email").text(o.user.user_email);l.find(".event-details-roles").text(o.user.user_roles);l.find(".event-details-entry-img").css("background-image","url("+o.user.avatar+")");l.find(".event-visit-profile").attr("href",o.user.user_link);break;case"entry":c.find(".event-details-name").text(o.entry.entry_name);l.find(".event-details-description").text(o.entry.entry_description);l.find(".event-details-entry-img").css("background-image","url("+o.entry.entry_thumbnails+")");if(o.entry.entry_link===false){l.find(".event-download-entry").fadeOut()}else{l.find(".event-download-entry").attr("href",o.entry.entry_link+"&_ajax_nonce="+n.options.admin_nonce)}break}a(".useyourdrive-modal-body").fadeIn();a(".useyourdrive-modal-footer").fadeIn();a(".modal-content .loading:first").fadeOut()},complete:function(){l.find(".loading").fadeOut()},dataType:"json"});n.loadDetailedLog(a("#useyourdrive-modal-action .modal-content table"),j,f);var b=new RModal(document.getElementById("useyourdrive-modal-action"),{dialogOpenClass:"animated slideInDown",dialogCloseClass:"animated slideOutUp",escapeClose:true});document.addEventListener("keydown",function(o){b.keydown(o)},false);b.open();window.modal_action=b}})})(jQuery);(function(a){a(".UseyourDriveDashboard").UseyourDriveDashboard(UseyourDrive_Dashboard_vars)})(jQuery);