
var iaa_isLinking=false;var iaa_links=new Array();var iaa_linkCurrentIndex=-1;var iaa_canvasTimer;var iaa_mouseX,iaa_mouseY;var iaa_linkGradientIndex=1;var iaa_itemWinTimer;var iaa_currentDomElement=false;var iaa_currentStep=false;var iaa_defaultStep=false;var iaa_steps=false;var iaa_params;var iaa_lock=false;var iaa_currentLinkIndex=0;var iaa_settings;var iaa_formfield;var iaa_canSaveLink=true;iaa_data=iaa_data[0];jQuery(document).ready(function(){jQuery("body").append('<div id="iaa_loader"><div class="iaa_spinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div>');jQuery("#iaa_loader").fadeIn();jQuery("#iaa_stepsContainer").droppable({drop:function(b,c){var a=jQuery(c.draggable[0]);jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_saveStepPosition",stepID:a.attr("data-stepid"),posX:parseInt(a.css("left")),posY:parseInt(a.css("top"))}})}});jQuery(".imageBtn").click(function(){iaa_formfield=jQuery(this).prev("input");tb_show("","media-upload.php?TB_iframe=true");return false});window.old_tb_remove=window.tb_remove;window.tb_remove=function(){window.old_tb_remove();iaa_formfield=null};window.original_send_to_editor=window.send_to_editor;window.send_to_editor=function(a){if(iaa_formfield){fileurl=jQuery("img",a).attr("src");jQuery(iaa_formfield).val(fileurl);if(jQuery(iaa_formfield).attr("id")=="iaa_settings_avatarImg"){iaa_autoSaveSettings()}if(jQuery(iaa_formfield).attr("id")=="iaa_settings_avatarTalkImg"){iaa_autoSaveSettings()}tb_remove()}else{window.original_send_to_editor(a)}};jQuery("#iaa_avatarCustomPreview #iaa_avatarCustomPreview_mouth").draggable({containment:"#iaa_avatarCustomPreviewContent",axis:"y"});jQuery(".colorpick").each(function(){var a=jQuery(this);if(jQuery(this).prev(".iaa_colorPreview").length==0){jQuery(this).before('<div class="iaa_colorPreview" style="background-color:#'+a.val().substr(1,7)+'"></div>')}jQuery(this).prev(".iaa_colorPreview").click(function(){jQuery(this).next(".colorpick").trigger("click")});jQuery(this).colpick({color:a.val().substr(1,7),onChange:function(b,f,d,e,c){jQuery(e).val("#"+f);jQuery(e).prev(".iaa_colorPreview").css({backgroundColor:"#"+f})}})});if(jQuery("#iaa_winActivation").is('[data-show="true"]')&&document.location.href.indexOf("admin.php?page=iaa_")>-1){jQuery("#iaa_winActivation").modal("show");jQuery("#iaa_winActivation .modal-dialog").hover(function(){jQuery(this).addClass("iaa_hover")},function(){jQuery(this).removeClass("iaa_hover")});iaa_lock=true;jQuery("#iaa_closeWinActivationBtn").click(function(){if(!iaa_lock){jQuery("#iaa_winActivation").modal("hide")}});jQuery("#iaa_closeWinActivationBtn .iaa_text").data("num",10).html("Wait 10 seconds");iaa_actTimer=setInterval(function(){var a=jQuery("#iaa_closeWinActivationBtn .iaa_text").data("num");a--;if(a>0){jQuery("#iaa_closeWinActivationBtn .iaa_text").data("num",a).html("Wait "+a+" seconds")}else{jQuery("#iaa_closeWinActivationBtn").removeClass("disabled");iaa_lock=false;jQuery("#iaa_closeWinActivationBtn .iaa_text").data("num","").html("Close")}},1000)}else{jQuery("#iaa_winActivation").attr("data-show","false")}jQuery("#iaa_winActivation").on("hide.bs.modal",function(a){if(iaa_lock&&!jQuery("#iaa_winActivation .modal-dialog").is(".iaa_hover")){a.preventDefault()}});jQuery("#wpwrap").css({height:jQuery("#iaa_bootstraped").height()+48});setInterval(function(){if(jQuery("#iaa_winStep").css("display")=="block"){jQuery("#wpwrap").css({height:jQuery("#iaa_winStep").height()+48})}else{jQuery("#wpwrap").css({height:jQuery("#iaa_bootstraped").height()+48})}},1000);jQuery("#iaa_settings_avatarType").change(function(){if(jQuery("#iaa_settings_avatarType").val()=="0"){jQuery("#iaa_avatarDefault").show();jQuery("#iaa_avatarCustom").hide()}else{jQuery("#iaa_avatarDefault").hide();jQuery("#iaa_avatarCustom").show()}iaa_settings_updatePreviewCustomAvatar()});iaa_canvasTimer=setInterval(iaa_updateStepCanvas,30);jQuery(document).mousemove(function(a){if(iaa_isLinking){iaa_mouseX=a.pageX-jQuery("#iaa_stepsContainer").offset().left;iaa_mouseY=a.pageY-jQuery("#iaa_stepsContainer").offset().top}});jQuery(window).resize(iaa_updateStepsDesign);if(jQuery('#iaa_bootstraped.iaa_bootstraped  [data-toggle="select"]').length>0){jQuery('#iaa_bootstraped.iaa_bootstraped  [data-toggle="select"]').select2()}iaa_itemWinTimer=setInterval(iaa_updateWinItemPosition,30);jQuery("#iaa_actionSelect").change(function(){iaa_changeActionBubble(jQuery("#iaa_actionSelect").val())});jQuery("#iaa_interactionSelect").change(function(){iaa_changeInteractionBubble(jQuery("#iaa_interactionSelect").val())});jQuery("#iaa_interactionBubble,#iaa_actionBubble,#iaa_linkBubble").hover(function(){jQuery(this).addClass("iaa_hover")},function(){jQuery(this).removeClass("iaa_hover")});jQuery("body").click(function(){if(!jQuery("#iaa_interactionBubble").is(".iaa_hover")){jQuery("#iaa_interactionBubble").fadeOut()}if(!jQuery("#iaa_actionBubble").is(".iaa_hover")&&!jQuery("#iaa_websiteFrame").is(".iaa_hover")&&!jQuery(".iaa_selectElementPanel").is(".iaa_hover")){jQuery("#iaa_actionBubble").fadeOut()}if(!jQuery("#iaa_linkBubble").is(".iaa_hover")){jQuery("#iaa_linkBubble").fadeOut()}});jQuery(document).mousedown(function(a){if(a.button==2&&iaa_isLinking){iaa_isLinking=false}});jQuery(".iaa_avatarSettingsField a").click(iaa_avatarChangePart);jQuery("#iaa_stepText,#iaa_stepTitle").keyup(iaa_previewStep);iaa_loadSteps();iaa_loadSettings()});function iaa_autoSaveSettings(){sessionStorage.openSettings=1;iaa_saveSettings()}function iaa_loadSteps(){jQuery("#iaa_stepsContainer .iaa_stepBloc,.iaa_loadSteps,.iaa_linkPoint").remove();jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_loadSteps"},success:function(a){a=JSON.parse(a);iaa_params=a.params;iaa_steps=a.steps;jQuery.each(a.steps,function(b){var c=this;c.content=JSON.parse(c.content);iaa_addStep(c)});jQuery.each(a.links,function(b){var c=this;c.originID=jQuery('.iaa_stepBloc[data-stepid="'+c.originID+'"]').attr("id");c.destinationID=jQuery('.iaa_stepBloc[data-stepid="'+c.destinationID+'"]').attr("id");c.conditions=JSON.parse(c.conditions);iaa_links[b]=c});jQuery("#iaa_loader").fadeOut()}})}function iaa_getStepByID(b){var a=false;jQuery.each(iaa_steps,function(c){if(this.id==b){a=this}});return a}function iaa_addStep(c){var e="";var a=0;if(!c.content){e=c}else{e=c.content.title}var b=jQuery('<div class="iaa_stepBloc palette palette-clouds"><div class="iaa_stepBlocWrapper"><h4>'+e+'</h4></div><a href="javascript:" class="iaa_btnEdit"><span class="glyphicon glyphicon-pencil"></span></a><a href="javascript:" class="iaa_btnSup"><span class="glyphicon glyphicon-trash"></span></a><a href="javascript:" class="iaa_btnLink"><span class="glyphicon glyphicon-link"></span></a><a href="javascript:" class="iaa_btnStart"><span class="glyphicon glyphicon-flag"></span></a></div>');if(c.content&&c.content.start==1){b.find(".iaa_btnStart").addClass("iaa_selected");b.addClass("iaa_selected")}if(c.elementID){b.attr("id",c.elementID)}else{b.uniqueId()}b.children("a.iaa_btnEdit").click(function(){iaa_openWinStep(jQuery(this).parent().attr("data-stepid"))});b.children("a.iaa_btnLink").click(function(){iaa_startLink(jQuery(this).parent().attr("id"))});b.children("a.iaa_btnSup").click(function(){iaa_removeStep(jQuery(this).parent().attr("data-stepid"))});b.children("a.iaa_btnStart").click(function(){jQuery(".iaa_stepBloc[data-stepid]").find(".iaa_btnStart").removeClass("iaa_selected");jQuery(".iaa_stepBloc[data-stepid]").find(".iaa_btnStart").closest(".iaa_stepBloc").removeClass("iaa_selected");jQuery.each(iaa_steps,function(){var h=this;if(h.id!=jQuery(this).parent().attr("data-stepid")&&h.content.start==1){h.content.start=0;jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_saveStep",step:JSON.stringify(h.content)},success:function(){iaa_loadSteps()}})}});jQuery(this).addClass("iaa_selected");jQuery(this).closest(".iaa_stepBloc").addClass("iaa_selected");var g=iaa_getStepByID(jQuery(this).parent().attr("data-stepid"));g.content.start=1;jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_saveStep",step:JSON.stringify(g.content)}})});b.draggable({containment:"parent",handle:".iaa_stepBlocWrapper"});b.children(".iaa_stepBlocWrapper").click(function(){if(iaa_isLinking){iaa_stopLink(b)}});var f=10,d=10;if(c.content&&c.content.previewPosX){f=c.content.previewPosX;d=c.content.previewPosY}else{f=jQuery("#iaa_stepsOverflow").scrollLeft()+jQuery("#iaa_stepsOverflow").width()/2-64;d=jQuery("#iaa_stepsOverflow").scrollTop()+jQuery("#iaa_stepsOverflow").height()/2-64}b.hide();jQuery("#iaa_stepsContainer").append(b);b.css({left:(f)+"px",top:d+"px"});b.fadeIn();iaa_updateStepsDesign();jQuery(".iaa_btnWinClose").parent().click(function(){iaa_closeWin(jQuery(this).parents(".iaa_window"))});if(iaa_steps.length==0){a=1}if(c.id){b.attr("data-stepid",c.id)}else{jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_addStep",elementID:b.attr("id"),previewPosX:f,previewPosY:d,start:a},success:function(g){g=jQuery.parseJSON(g);b.attr("data-stepid",g.id);if(g.start==1){b.find(".iaa_btnStart").addClass("iaa_selected");b.addClass("iaa_selected")}iaa_steps.push({content:g})}})}}function iaa_removeStep(b){var a=0;jQuery('.iaa_stepBloc[data-stepid="'+b+'"]').remove();jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_removeStep",stepID:b},success:function(){}})}function iaa_updateStepsDesign(){jQuery("#wpwrap").css({height:jQuery("#iaa_bootstraped").height()+48});jQuery("#iaa_stepsCanvas").attr("width",jQuery("#iaa_stepsContainer").outerWidth());jQuery("#iaa_stepsCanvas").attr("height",jQuery("#iaa_stepsContainer").outerHeight());jQuery("#iaa_stepsCanvas").css({width:jQuery("#iaa_stepsContainer").outerWidth(),height:jQuery("#iaa_stepsContainer").outerHeight()});jQuery("#iaa_stepsContainer .iaa_stepBloc > .iaa_stepBlocWrapper > h4").each(function(){jQuery(this).css("margin-top",0-jQuery(this).height()/2)})}function iaa_repositionLinkPoint(c){var e=iaa_links[c];var a=(jQuery("#"+e.originID).offset().left-jQuery("#iaa_stepsContainer").offset().left)+jQuery("#"+e.originID).width()/2;var d=(jQuery("#"+e.originID).offset().top-jQuery("#iaa_stepsContainer").offset().top)+jQuery("#"+e.originID).height()/2;var b=(jQuery("#"+e.destinationID).offset().left-jQuery("#iaa_stepsContainer").offset().left)+jQuery("#"+e.destinationID).width()/2;var f=(jQuery("#"+e.destinationID).offset().top-jQuery("#iaa_stepsContainer").offset().top)+jQuery("#"+e.destinationID).height()/2;var h=a+(b-a)/2;var g=d+(f-d)/2;jQuery.each(iaa_links,function(j){if(this.originID==e.destinationID&&this.destinationID==e.originID&&j<c){h+=15;g+=15}});jQuery('.iaa_linkPoint[data-linkindex="'+c+'"]').css({left:h+"px",top:g+"px"})}function iaa_loadSettings(){jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_loadSettings"},success:function(a){a=jQuery.parseJSON(a);iaa_settings=a;jQuery('.iaa_avatarContainer [data-type="corpse"]').attr("data-num",a.avatar_corpse);jQuery('.iaa_avatarContainer [data-type="hair"]').attr("data-num",a.avatar_hair);jQuery('.iaa_avatarContainer [data-type="head"]').attr("data-num",a.avatar_head);jQuery('.iaa_avatarContainer [data-type="eyes"]').attr("data-num",a.avatar_eyes);jQuery('.iaa_avatarContainer [data-type="mouth"]').attr("data-num",a.avatar_mouth);jQuery("#iaa_settings_position").val(a.positionScreen);jQuery("#iaa_settings_initialText").val(a.initialText);jQuery("#iaa_settings_enable").val(a.enabled);jQuery("#iaa_settings_hideOnClose").val(a.hideOnClose);jQuery("#iaa_settings_colorBubble").val(a.colorBubble);jQuery("#iaa_settings_colorText").val(a.colorText);jQuery("#iaa_settings_colorButtons").val(a.colorButtons);jQuery("#iaa_settings_colorButtonsText").val(a.colorButtonsText);jQuery("#iaa_settings_colorShine").val(a.colorShine);jQuery("#iaa_settings_avatarType").val(a.avatarType);jQuery("#iaa_settings_disableIntro").val(a.disableIntro);jQuery("#iaa_settings_useWPML").val(a.useWPML);jQuery("#iaa_settings_disableMobile").val(a.disableMobile);if(iaa_settings.avatarType){jQuery("#iaa_avatarCustomPreviewContent img").load(function(){iaa_settings_updatePreviewCustomAvatar()})}iaa_settings_updatePreviewCustomAvatar();if(sessionStorage.openSettings&&sessionStorage.openSettings==1){sessionStorage.openSettings=0;iaa_openSettings()}}})}function iaa_settings_updatePreviewCustomAvatar(){if(jQuery("#iaa_settings_avatarType").val()=="1"){jQuery(".iaa_avatarContainer").addClass("iaa_customAvatar");if(jQuery("#iaa_avatarCustomPreviewContent").width()>0){jQuery(".iaa_avatarContainer").css({width:jQuery("#iaa_avatarCustomPreviewContent").width()+"px",height:jQuery("#iaa_avatarCustomPreviewContent").height()+"px"});jQuery(".iaa_avatarContainer").append('<img class="iaa_avatar_img" style="width: 100%; height: 100%; position: relative;" src="'+jQuery("#iaa_avatarCustomPreviewContent > img:eq(0)").attr("src")+'" />');jQuery(".iaa_avatarContainer").append('<img class="iaa_avatar_mouth" style="left:'+jQuery("#iaa_avatarCustomPreviewContent").width()/2+"px; margin-left: -"+jQuery("#iaa_avatarCustomPreview_mouth").width()/2+'px;" src="'+jQuery("#iaa_avatarCustomPreviewContent > img:eq(1)").attr("src")+'" />');jQuery(".iaa_avatarContainer img.iaa_avatar_mouth").css({top:jQuery("#iaa_avatarCustomPreviewContent > img:eq(1)").css("top")});jQuery("#iaa_avatarCustomPreview_mouth").css({left:"50%",top:jQuery("#iaa_avatarCustomPreviewContent > img:eq(1)").css("top"),marginLeft:(0-jQuery("#iaa_avatarCustomPreview_mouth").width()/2)+"px"})}else{jQuery(".iaa_avatarContainer").css({width:iaa_settings.avatarWidth+"px",height:iaa_settings.avatarHeight+"px"});jQuery(".iaa_avatarContainer").append('<img class="iaa_avatar_img" style="width: 100%; height: 100%; position: relative;" src="'+iaa_settings.avatarImg+'" />');jQuery(".iaa_avatarContainer").append('<img class="iaa_avatar_mouth" style="left:'+iaa_settings.avatarWidth/2+"px; margin-left: -"+iaa_settings.avatarMouthWidth/2+'px;" src="'+iaa_settings.avatarTalkImg+'" />');jQuery(".iaa_avatarContainer img.iaa_avatar_mouth").css({top:iaa_settings.avatarMouthY+"px"});jQuery("#iaa_avatarCustomPreview_mouth").css({left:"50%",top:iaa_settings.avatarMouthY+"px",marginLeft:(0-jQuery("#iaa_avatarCustomPreview_mouth").width()/2)+"px"})}}else{jQuery(".iaa_avatarContainer img").remove();jQuery(".iaa_avatarContainer").removeClass("iaa_customAvatar");jQuery(".iaa_avatarContainer").css({width:128,height:146});jQuery("#iaa_bootstraped.iaa_bootstraped .iaa_talkBubble").css({bottom:"96px"})}jQuery("#iaa_talkBubble").each(function(){jQuery(this).css({bottom:parseInt(jQuery(this).closest(".iaa_avatarContainer").css("height"))+13})})}function iaa_openSettings(){if(iaa_settings.avatarType==1){jQuery("#iaa_avatarDefault").hide();jQuery("#iaa_avatarCustom").show()}else{jQuery("#iaa_avatarDefault").show();jQuery("#iaa_avatarCustom").hide()}jQuery("#iaa_panelPreview").fadeOut();jQuery("#iaa_panelSettings").fadeIn();jQuery("#iaa_avatarCustomPreview_mouth").css({left:"50%",top:iaa_settings.avatarMouthY+"px",marginLeft:0-jQuery("#iaa_avatarCustomPreview_mouth").width()/2})}function iaa_closeSettings(){jQuery("#iaa_panelPreview").fadeIn();jQuery("#iaa_panelSettings").fadeOut()}function iaa_saveSettings(){var c=jQuery('#iaa_avatarPreviewContainer [data-type="corpse"]').attr("data-num");var d=jQuery('#iaa_avatarPreviewContainer [data-type="head"]').attr("data-num");var b=jQuery('#iaa_avatarPreviewContainer [data-type="hair"]').attr("data-num");var e=jQuery('#iaa_avatarPreviewContainer [data-type="eyes"]').attr("data-num");var a=jQuery('#iaa_avatarPreviewContainer [data-type="mouth"]').attr("data-num");jQuery("#iaa_loader").fadeIn();jQuery.ajax({type:"post",url:ajaxurl,data:{action:"iaa_saveSettings",corpse_num:c,head_num:d,hair_num:b,eyes_num:e,mouth_num:a,position:jQuery("#iaa_settings_position").val(),initialText:jQuery("#iaa_settings_initialText").val(),hideOnClose:jQuery("#iaa_settings_hideOnClose").val(),enable:jQuery("#iaa_settings_enable").val(),colorBubble:jQuery("#iaa_settings_colorBubble").val(),colorText:jQuery("#iaa_settings_colorText").val(),colorButtons:jQuery("#iaa_settings_colorButtons").val(),colorButtonsText:jQuery("#iaa_settings_colorButtonsText").val(),colorShine:jQuery("#iaa_settings_colorShine").val(),avatarType:jQuery("#iaa_settings_avatarType").val(),avatarImg:jQuery("#iaa_settings_avatarImg").val(),avatarTalkImg:jQuery("#iaa_settings_avatarTalkImg").val(),avatarMouthY:parseInt(jQuery("#iaa_avatarCustomPreview_mouth").css("top")),avatarWidth:jQuery("#iaa_avatarCustomPreview").width(),avatarHeight:jQuery("#iaa_avatarCustomPreview").height(),avatarMouthWidth:jQuery("#iaa_avatarCustomPreview_mouth").width(),disableIntro:jQuery("#iaa_settings_disableIntro").val(),disableMobile:jQuery("#iaa_settings_disableMobile").val(),useWPML:jQuery("#iaa_settings_useWPML").val(),code:jQuery("#iaa_settings_purchaseCode").val()},success:function(){document.location.href=document.location.href}})}function iaa_avatarChangePart(d){var c=jQuery(this).parent().attr("data-part");var a=jQuery('#iaa_avatarPreviewContainer [data-type="'+c+'"]').attr("data-max");var b=jQuery('#iaa_avatarPreviewContainer [data-type="'+c+'"]').attr("data-num");if(jQuery(this).find("span").is(".glyphicon.glyphicon-chevron-left")){b--;if(b<1){b=a}}else{b++;if(b>a){b=1}}jQuery('#iaa_avatarPreviewContainer [data-type="'+c+'"]').attr("data-num",b)}function iaa_updateStepCanvas(){iaa_linkGradientIndex++;if(iaa_linkGradientIndex>=30){iaa_linkGradientIndex=1}var a=jQuery("#iaa_stepsCanvas").get(0).getContext("2d");a.clearRect(0,0,jQuery("#iaa_stepsCanvas").attr("width"),jQuery("#iaa_stepsCanvas").attr("height"));jQuery.each(iaa_links,function(m){var p=this;if(p.destinationID&&jQuery("#"+p.originID).length>0&&jQuery("#"+p.destinationID).length>0){var f=parseInt(jQuery("#"+p.originID).css("left"))+jQuery("#"+p.originID).outerWidth()/2+22;var e=parseInt(jQuery("#"+p.originID).css("top"))+jQuery("#"+p.originID).outerHeight()/2+22;var k=parseInt(jQuery("#"+p.destinationID).css("left"))+jQuery("#"+p.destinationID).outerWidth()/2+22;var h=parseInt(jQuery("#"+p.destinationID).css("top"))+jQuery("#"+p.destinationID).outerHeight()/2+22;var i=a.createLinearGradient(f,e,k,h);var g=false;var j=iaa_linkGradientIndex/30;var o=j;var n=j+0.1;var l=j+0.2;a.lineWidth=4;if(n>1){n=0;l=0.2}if(l>1){l=0}i.addColorStop(o,"#bdc3c7");i.addColorStop(n,"#1ABC9C");i.addColorStop(l,"#bdc3c7");a.strokeStyle=i;a.beginPath();a.moveTo(f,e);a.lineTo(k,h);a.stroke();if(jQuery('.iaa_linkPoint[data-linkindex="'+m+'"]').length==0){var q=jQuery('<a href="javascript:" data-linkindex="'+m+'" class="iaa_linkPoint"><span class="glyphicon glyphicon-pencil"></span></a>');jQuery("#iaa_stepsContainer").append(q);q.click(function(){iaa_openWinLink(jQuery(this))})}iaa_repositionLinkPoint(m)}else{jQuery('.iaa_linkPoint[data-linkindex="'+m+'"]').remove()}});if(iaa_isLinking){var b=jQuery("#"+iaa_links[iaa_linkCurrentIndex].originID);var d=b.position().left+jQuery("#iaa_stepsOverflow").scrollLeft()+b.outerWidth()/2;var c=b.position().top+jQuery("#iaa_stepsOverflow").scrollTop()+b.outerHeight()/2;a.strokeStyle="#bdc3c7";a.lineWidth=4;a.beginPath();a.moveTo(d,c);a.lineTo(iaa_mouseX,iaa_mouseY);a.stroke()}}function iaa_checkLicense(){var a=false;var b=jQuery('#iaa_winActivation input[name="purchaseCode"]');if(b.val().length<9){b.parent().addClass("has-error")}else{jQuery("#iaa_loader").delay(1400).fadeIn(100);jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_checkLicense",code:b.val()},success:function(c){jQuery("#iaa_loader").fadeOut();if(c.length=="1"){b.parent().addClass("has-error")}else{iaa_lock=false;jQuery("#iaa_winActivation").modal("hide")}}})}}function iaa_openWinStep(a){if(iaa_settings.positionScreen==1){jQuery("#iaa_stepPreview #iaa_avatarPreviewContainer").addClass("iaa_right")}else{jQuery("#iaa_stepPreview #iaa_avatarPreviewContainer").removeClass("iaa_right")}if(!a){var a=0}else{jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_loadStep",stepID:a},success:function(b){b=jQuery.parseJSON(b);b.content=jQuery.parseJSON(b.content);b.content.id=b.id;iaa_currentStep=b.content;iaa_defaultStep=jQuery.extend(true,{},iaa_currentStep);jQuery("#iaa_stepTitle").val(b.content.title);jQuery("#iaa_stepText").val(b.content.text.replace(/\r?<br \/>/g,"\n"));jQuery("#iaa_interactionsWrapper >*,#iaa_actionsWrapper >*").not(".iaa_stepIconPlus").remove();if(iaa_currentStep.interactions){jQuery.each(iaa_currentStep.interactions,function(){var c=this;iaa_createInteraction(c)})}if(iaa_currentStep.actions){jQuery.each(iaa_currentStep.actions,function(){var c=this;iaa_createAction(c)})}jQuery("#iaa_btns").html("");jQuery("#iaa_winStep").fadeIn();jQuery("#iaa_stepsContainer").slideUp();iaa_previewStep();jQuery("#wpwrap").css({height:jQuery("#iaa_winStep").height()+48})}})}iaa_currentStep={id:a,text:"",actions:new Array(),interactions:new Array()}}function iaa_createAction(d){var c="";var b=true;if(d.elementID){b=false}switch(d.type){case"showElement":c="glyphicon glyphicon-search";break;case"sendEmail":c="glyphicon glyphicon-envelope";break;case"changeUrl":c="glyphicon glyphicon-share-alt";break;case"executeJS":c="glyphicon glyphicon-flash";break;case"sendInteractions":c="glyphicon glyphicon-cloud-upload";break}var a=jQuery('<div class="iaa_actionCircle" data-type="'+d.type+'"><span class="'+c+'"></span></div>');a.hide();a.uniqueId();if(b){d.elementID=a.attr("id");iaa_currentStep.actions.push(d)}else{a.attr("id",d.elementID)}jQuery("#iaa_actionsWrapper .iaa_stepIconPlus").before(a);a.fadeIn(250);a.click(function(){iaa_openWinAction(jQuery(this))})}function iaa_createInteraction(e){var c="";var d="";var b=true;if(e.elementID){b=false}switch(e.type){case"textfield":d="T";break;case"numberfield":d="1";break;case"select":c="glyphicon glyphicon-th-list";break;case"button":c="glyphicon glyphicon-hand-up";break}var a=jQuery('<div class="iaa_actionCircle" data-type="'+e.type+'"><span class="'+c+'">'+d+"</span></div>");a.hide();a.uniqueId();e.elementID=a.attr("id");if(b){iaa_currentStep.interactions.push(e)}jQuery("#iaa_interactionsWrapper .iaa_stepIconPlus").before(a);a.fadeIn(250);a.click(function(){iaa_openWinInteraction(jQuery(this))})}function iaa_closeWin(a){a.fadeOut();jQuery("#iaa_stepsContainer").slideDown()}function iaa_startLink(a){iaa_isLinking=true;iaa_linkCurrentIndex=iaa_links.length;iaa_links.push({originID:a,destinationID:null})}function iaa_stopLink(a){iaa_isLinking=false;var b=false;jQuery.each(iaa_links,function(){if(this.originID==iaa_links[iaa_linkCurrentIndex].originID&&this.destinationID==a.attr("id")){b=this}});if(!b){jQuery("#iaa_loader").fadeIn();iaa_links[iaa_linkCurrentIndex].destinationID=a.attr("id");jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_newLink",originStepID:jQuery("#"+iaa_links[iaa_linkCurrentIndex].originID).attr("data-stepid"),destinationStepID:jQuery("#"+iaa_links[iaa_linkCurrentIndex].destinationID).attr("data-stepid")},success:function(c){iaa_links[iaa_linkCurrentIndex].id=c;iaa_loadSteps()}})}else{jQuery.grep(iaa_links,function(c){return c!=b})}}function iaa_itemsCheckRows(b){var a=jQuery(b).parent().children(".clearfix");a.detach();jQuery(b).parent().append(a)}function iaa_openWinInteraction(a){jQuery("#iaa_interactionBubble ").find("input,select").parent().removeClass("has-error");jQuery("#iaa_interactionBubble").addClass("iaa_hover");setTimeout(function(){jQuery("#iaa_interactionBubble").removeClass("iaa_hover")},50);if(jQuery("#iaa_interactionBubble").css("display")=="block"){jQuery("#iaa_interactionBubble").fadeOut()}jQuery("#iaa_interactionBubble").attr("data-item",a.attr("id"));jQuery("#iaa_interactionBubble").css({top:a.offset().top-jQuery("#iaa_bootstraped.iaa_bootstraped").offset().top+a.outerHeight()+12,left:a.offset().left-jQuery("#iaa_bootstraped.iaa_bootstraped").offset().left});jQuery("#iaa_interactionBubble #iaa_interactionContent > [data-type]").hide();if(a.attr("data-type")){jQuery('#iaa_interactionBubble #iaa_interactionContent > [data-type="select"] .form-group:not(.default)').remove();jQuery("#iaa_interactionBubble").attr("data-type",a.attr("data-type"));jQuery("#iaa_interactionBubble").data("type",a.attr("data-type"));jQuery('#iaa_interactionBubble #iaa_interactionContent > [data-type="'+a.attr("data-type")+'"]').slideDown();jQuery("#iaa_interactionSelect").select2("val",a.attr("data-type"));jQuery('#iaa_interactionBubble input[name="itemID"]').val(iaa_currentStep.interactions[a.index()].itemID);jQuery.each(iaa_currentStep.interactions[a.index()],function(b){jQuery('#iaa_interactionBubble #iaa_interactionContent > [data-type="'+a.attr("data-type")+'"]').find('[name="'+b+'"]').val(this);if(a.attr("data-type")=="numberfield"&&b=="validation"){if(this=="fill"){jQuery("#iaa_interactionValidationSelectNum").val("fill")}else{jQuery("#iaa_interactionValidationSelectNum").val("")}}if(a.attr("data-type")=="textfield"&&b=="validation"){if(this=="fill"){jQuery("#iaa_interactionValidationSelect").val("fill")}else{if(this=="email"){jQuery("#iaa_interactionValidationSelect").val("email")}else{jQuery("#iaa_interactionValidationSelect").val("")}}}if(a.attr("data-type")=="select"&&b.substr(0,2)=="s_"){var c=iaa_interactionAddSelect("select");c.find("input").val(this)}})}else{jQuery("#iaa_interactionBubble").removeAttr("data-item");jQuery("#iaa_interactionBubble").attr("data-type","null");jQuery("#iaa_interactionSelect").select2("val","");jQuery("#iaa_interactionBubble ").find("input,select").val("");jQuery("#iaa_interactionBubble ").find('input[name="itemID"]').val(iaa_getUniqueTime())}jQuery("#iaa_interactionBubble").fadeIn(250);setTimeout(function(){jQuery("#wpwrap").css({height:jQuery("#iaa_bootstraped").height()+48})},300)}function iaa_getUniqueTime(){var a=new Date().getTime();while(a==new Date().getTime()){}return new Date().getTime()}function iaa_changeInteractionBubble(b){jQuery("#iaa_interactionBubble").data("type",b);jQuery("#iaa_interactionBubble #iaa_interactionContent > div").slideUp();if(b!=""){jQuery('#iaa_interactionBubble #iaa_interactionContent > [data-type="'+b+'"]').slideDown()}if(b=="select"){var a=jQuery('#iaa_interactionContent > [data-type="'+b+'"]').find(".form-group:not(.default)").length;if(a==0||jQuery('#iaa_interactionContent > [data-type="'+b+'"]').find(".form-group:not(.default):last-child").find("input").val()==""){iaa_interactionAddSelect(b)}}}function iaa_interactionAddSelect(c){var b=jQuery('#iaa_interactionContent > [data-type="'+c+'"]').find(".form-group").length;var a=jQuery('<div class="form-group"><label>'+iaa_data.txt_option+'</label><input type="text" placeholder="'+iaa_data.txt_option+'" class="form-control" name="s_'+b+'_value"></div>');a.find("input").keyup(function(){if(jQuery(this).val()==""){if(jQuery(this).closest(".form-group:not(.default)").index()>0){jQuery(this).closest(".form-group:not(.default)").remove()}}else{if(jQuery(this).closest(".form-group:not(.default)").next(".form-group:not(.default)").length==0){iaa_interactionAddSelect(c)}}});jQuery('#iaa_interactionContent > [data-type="'+c+'"]').append(a);return a}function iaa_openWinLink(b){iaa_currentLinkIndex=b.attr("data-linkindex");jQuery("#iaa_winLink").attr("data-linkindex",b.attr("data-linkindex"));jQuery(".iaa_conditionItem").remove();var e=jQuery("#"+iaa_links[b.attr("data-linkindex")].originID).attr("data-stepid");var c=iaa_getStepByID(e);var d=jQuery("#"+iaa_links[b.attr("data-linkindex")].destinationID).attr("data-stepid");var a=iaa_getStepByID(d);jQuery("#iaa_linkInteractions").show();iaa_currentStep=c;jQuery("#iaa_linkOriginTitle").html(c.content.title);jQuery("#iaa_linkDestinationTitle").html(a.content.title);jQuery.each(iaa_links[iaa_currentLinkIndex].conditions,function(){iaa_addLinkInteraction(this)});jQuery("#iaa_winLink").fadeIn(250);setTimeout(function(){jQuery("#wpwrap").css({height:jQuery("#iaa_bootstraped").height()+48})},300)}function iaa_addLinkInteraction(h){var c=jQuery('<div class="iaa_conditionItem"></div>');var f=jQuery('<select class="iaa_conditionSelect form-control"></select>');f.append('<option value="_date" data-type="date">'+iaa_data.txt_currentDate+"</option>");f.append('<option value="_page" data-type="page">'+iaa_data.txt_currentPage+"</option>");jQuery.each(iaa_steps,function(){var i=this;jQuery.each(this.content.interactions,function(){var j=this;var l=i.id+"_"+j.itemID;var k=jQuery('#iaa_interactionSelect option[value="'+j.type+'"]').html();f.append('<option value="'+l+'" data-type="'+j.type+'">'+i.content.title+" : "+k+' " '+j.label+' "</option>')})});var b=jQuery('<select class="iaa_conditionoperatorSelect form-control"></select>');f.change(function(){var i=jQuery(this).parent().parent().find(".iaa_conditionoperatorSelect");i.find("option").remove();var j=iaa_conditionGetOperators(f.find("option").filter(":selected").attr("data-type"),f);jQuery.each(j,function(){i.append('<option value="'+this.value+'">'+this.text+"</option>")});b.change()});if(h){f.val(h.interaction)}f.change();var e=iaa_conditionGetOperators(f.find("option").filter(":selected").attr("data-type"),f);jQuery.each(e,function(){b.append('<option value="'+this.value+'">'+this.text+"</option>")});b.change(function(){iaa_linksUpdateFields(jQuery(this))});var g=jQuery('<div class="col-md-4"></div>');g.append(f);c.append(g);var a=jQuery('<div class="row"></div>');var d=jQuery('<div class="col-md-4"></div>');d.append(b);c.append(d);c.append('<div class="col-md-1"><a href="javascript:" class="iaa_conditionDelBtn" onclick="iaa_conditionRemove(this);"><span class="glyphicon glyphicon-remove"></span></a> </div>');if(h){b.val(h.action);b.change();if(h.value){b.parent().parent().find(".iaa_conditionValue").val(h.value)}}setTimeout(function(){iaa_linksUpdateFields(b,h);if(h.value){b.parent().parent().find(".iaa_conditionValue").val(h.value)}},500);jQuery("#iaa_linkInteractions").append(c)}function iaa_linksUpdateFields(b,a){b.parent().parent().find(".iaa_conditionValue").parent().remove();if(b.parent().parent().find(".iaa_conditionSelect option:selected").attr("data-type")=="page"){if(b.parent().parent().find(".iaa_conditionValue").length==0){b.parent().parent().find(".col-md-1").before('<div class="col-md-3"><input type="text" placeholder="http://..." class="iaa_conditionValue form-control" /> </div>')}}if(b.parent().parent().find(".iaa_conditionSelect option:selected").attr("data-type")=="numberfield"&&(b.val()=="inferior"||b.val()=="superior"||b.val()=="equal")){if(b.parent().parent().find(".iaa_conditionValue").length==0){b.parent().parent().find(".col-md-1").before('<div class="col-md-3"><input type="number" step="any" class="iaa_conditionValue form-control" /> </div>')}}if((b.parent().parent().find(".iaa_conditionSelect option:selected").attr("data-type")=="date"||b.parent().parent().find(".iaa_conditionSelect option:selected").attr("data-type")=="datefield")&&(b.val()=="inferior"||b.val()=="superior"||b.val()=="equal")){if(b.parent().parent().find(".iaa_conditionValue").length==0){b.parent().parent().find(".col-md-1").before('<div class="col-md-3"><input type="text" step="any" class="iaa_conditionValue form-control"/> </div>');b.parent().parent().find(".iaa_conditionValue").datepicker({dateFormat:"yy-mm-dd"})}if(a&&a.value){b.parent().parent().find(".iaa_conditionValue").val(a.value)}}}function iaa_conditionRemove(a){var b=jQuery(a);b.closest(".iaa_conditionItem").remove()}function iaa_linkSave(){if(iaa_canSaveLink){iaa_canSaveLink=false;setTimeout(function(){iaa_canSaveLink=true},1500);iaa_links[iaa_currentLinkIndex].conditions=new Array();jQuery(".iaa_conditionItem").each(function(){iaa_links[iaa_currentLinkIndex].conditions.push({interaction:jQuery(this).find(".iaa_conditionSelect").val(),action:jQuery(this).find(".iaa_conditionoperatorSelect").val(),value:jQuery(this).find(".iaa_conditionValue").val()})});var a=iaa_links.slice();jQuery.each(a,function(){this.originID=jQuery("#"+this.originID).attr("data-stepid");this.destinationID=jQuery("#"+this.destinationID).attr("data-stepid")});jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_saveLinks",links:JSON.stringify(a)},success:function(){iaa_closeWin(jQuery("#iaa_winLink"));iaa_loadSteps()}})}}function iaa_linkDel(){iaa_links.splice(jQuery.inArray(iaa_links[iaa_currentLinkIndex],iaa_links),1);var a=iaa_links.slice();jQuery.each(a,function(){this.originID=jQuery("#"+this.originID).attr("data-stepid");this.destinationID=jQuery("#"+this.destinationID).attr("data-stepid")});jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_saveLinks",links:JSON.stringify(a)},success:function(){iaa_closeWin(jQuery("#iaa_winLink"));iaa_loadSteps()}})}function iaa_conditionGetOperators(d,c){var b=new Array();switch(d){case"button":b.push({value:"clicked",text:iaa_data.txt_clicked});break;case"numberfield":b.push({value:"filled",text:iaa_data.txt_filled});b.push({value:"superior",text:iaa_data.txt_superiorTo});b.push({value:"inferior",text:iaa_data.txt_inferiorTo});b.push({value:"equal",text:iaa_data.txt_equalTo});break;case"textfield":b.push({value:"filled",text:iaa_data.txt_filled});break;case"page":b.push({value:"equal",text:iaa_data.txt_equalTo});break;case"datefield":b.push({value:"filled",text:iaa_data.txt_filled});b.push({value:"superior",text:iaa_data.txt_superiorTo});b.push({value:"inferior",text:iaa_data.txt_inferiorTo});b.push({value:"equal",text:iaa_data.txt_equalTo});break;case"date":b.push({value:"superior",text:iaa_data.txt_superiorTo});b.push({value:"inferior",text:iaa_data.txt_inferiorTo});b.push({value:"equal",text:iaa_data.txt_equalTo});break;case"select":var g=c.val().substr(0,c.val().indexOf("_"));var f=c.val().substr(c.val().indexOf("_")+1,c.val().length);var e=iaa_getStepByID(g);var a=false;if(e){jQuery.each(e.content.interactions,function(){if(this.itemID==f){a=this}});jQuery.each(a,function(h){if(h.substr(0,h.indexOf("_")+1)=="s_"&&this!=""){b.push({value:"v_"+this,text:this})}})}break}return b}function iaa_openWinAction($item){jQuery("#iaa_actionBubble").addClass("iaa_hover");setTimeout(function(){jQuery("#iaa_actionBubble").removeClass("iaa_hover")},50);var action=false;jQuery.each(iaa_currentStep.actions,function(){if(this.elementID==$item.attr("id")){action=this}});jQuery("#iaa_actionBubble").attr("data-item",$item.attr("id"));jQuery("#iaa_actionBubble").css({top:$item.offset().top-jQuery("#iaa_bootstraped.iaa_bootstraped").offset().top+$item.outerHeight()+12,left:$item.offset().left-jQuery("#iaa_bootstraped.iaa_bootstraped").offset().left});jQuery("#iaa_actionBubble #iaa_actionContent > [data-type]").hide();if($item.attr("data-type")){jQuery("#iaa_actionBubble").data("type",$item.attr("data-type"));jQuery("#iaa_actionSelect").select2("val",$item.attr("data-type"));jQuery('#iaa_actionBubble #iaa_actionContent > [data-type="'+$item.attr("data-type")+'"]').find("input,select,textarea").each(function(){eval("jQuery(this).val(action."+jQuery(this).attr("name")+".replace(/\\[g\\]/g,'\"'));");eval("jQuery(this).val(action."+jQuery(this).attr("name")+".replace(/\\|g\\|/g,'\"'));")});jQuery('#iaa_actionBubble #iaa_actionContent > [data-type="'+$item.attr("data-type")+'"]').slideDown()}else{jQuery("#iaa_actionSelect").select2("val","");jQuery("#iaa_actionBubble").removeAttr("data-item")}jQuery("#iaa_actionElementSelected").hide();jQuery("#iaa_actionBubble").fadeIn()}function iaa_changeActionBubble(a){jQuery("#iaa_actionBubble").data("type",a);jQuery("#iaa_actionBubble #iaa_actionContent > div").slideUp();if(a!=""){jQuery('#iaa_actionBubble #iaa_actionContent > [data-type="'+a+'"]').slideDown()}}function iaa_updateWinItemPosition(){if(jQuery("#iaa_winStep").css("display")!="none"){var a=jQuery("#"+jQuery("#iaa_itemWindow").attr("data-item"));if(a.length>0){jQuery("#iaa_itemWindow").css({top:a.offset().top-jQuery("#iaa_bootstraped.iaa_bootstraped").offset().top+a.outerHeight()+12,left:a.offset().left-jQuery("#iaa_bootstraped.iaa_bootstraped").offset().left})}else{jQuery("#iaa_itemWindow").fadeOut()}}else{jQuery("#iaa_itemWindow").fadeOut()}}function iaa_checkEmail(a){if(a.indexOf("@")!="-1"&&a.indexOf(".")!="-1"&&a!=""){return true}return false}function iaa_actionSave(){var title=iaa_data.txt_redirection;var chkCreate=true;var options={};if(jQuery("#iaa_actionBubble").data("type")){type=jQuery("#iaa_actionBubble").data("type");if(jQuery("#iaa_actionBubble").data("type")=="showElement"){title=iaa_data.txt_showElement;if(jQuery('#iaa_actionBubble [data-type="showElement"]  [name="element"]').val()==""){chkCreate=false;jQuery('#iaa_actionBubble [data-type="showElement"] a').addClass("btn-danger")}}else{if(jQuery("#iaa_actionBubble").data("type")=="sendEmail"){title=iaa_data.txt_sendEmail;if(!iaa_checkEmail(jQuery('#iaa_actionBubble [data-type="sendEmail"]  [name="email"]').val())){chkCreate=false;jQuery('#iaa_actionBubble  [data-type="sendEmail"] [name="email"]').parent().addClass("has-error")}}else{if(jQuery("#iaa_actionBubble").data("type")=="changeUrl"){if(jQuery('#iaa_actionBubble [data-type="changeUrl"] [name="url"]').val().indexOf("http")<0){chkCreate=false;jQuery('#iaa_actionBubble  [data-type="changeUrl"] [name="url"]').parent().addClass("has-error")}}else{if(jQuery("#iaa_actionBubble").data("type")=="executeJS"){if(jQuery('#iaa_actionBubble [data-type="executeJS"] [name="executeJS"]').val().length<3){chkCreate=false;jQuery('#iaa_actionBubble  [data-type="executeJS"] [name="executeJS"]').parent().addClass("has-error")}}}}}if(chkCreate){jQuery('#iaa_actionBubble [data-type="'+type+'"] select,#iaa_actionBubble [data-type="'+type+'"] input, #iaa_actionBubble [data-type="'+type+'"] textarea').each(function(){var value=jQuery(this).val().replace(/\"/g,"|g|");eval("options."+jQuery(this).attr("name")+"= value;");options.type=type});options.elementID=jQuery("#iaa_actionBubble").attr("data-item");if(jQuery("#iaa_actionBubble").attr("data-item")&&jQuery("#iaa_actionBubble").attr("data-item")!=""){iaa_currentStep.actions[jQuery("#"+jQuery("#iaa_actionBubble").attr("data-item")).index()]=options}else{iaa_createAction(options)}jQuery("#iaa_actionBubble #iaa_actionContent > div").slideUp();jQuery("#iaa_actionBubble").fadeOut();iaa_previewStep()}}else{chkCreate=false;jQuery("#iaa_interactionBubble #iaa_actionSelect").val("");jQuery("#iaa_actionBubble #iaa_actionContent > div").slideUp();jQuery("#iaa_actionBubble").fadeOut()}}function iaa_interactionDel(){jQuery("#iaa_interactionBubble").fadeOut();var b=jQuery("#iaa_interactionBubble").attr("data-item");if(b&&b!=""){var a=jQuery("#"+b).index();iaa_currentStep.interactions.splice(a,1);jQuery("#iaa_interactionsWrapper .iaa_actionCircle").eq(a).remove()}iaa_previewStep()}function iaa_existInDefaultStep(b){var a=false;jQuery.each(iaa_defaultStep.interactions,function(){var c=this;if(c.itemID==b){a=true}});return a}function iaa_actionDel(){jQuery("#iaa_actionBubble").fadeOut();var b=jQuery("#iaa_actionBubble").attr("data-item");if(b&&b!=""){var a=jQuery("#"+b).index();iaa_currentStep.actions.splice(a,1);jQuery("#iaa_actionsWrapper .iaa_actionCircle").eq(a).remove()}}function iaa_interactionSave(){var spanClass="";var spanContent="";var title=iaa_data.txt_redirection;var chkCreate=true;var type="";var options={};if(jQuery("#iaa_interactionBubble").data("type")){type=jQuery("#iaa_interactionBubble").data("type");if(jQuery("#iaa_interactionBubble").data("type")=="textfield"){spanContent="T";title=iaa_data.txt_textfield;if(jQuery('#iaa_interactionBubble [data-type="textfield"] [name="label"]').val()==""){chkCreate=false;jQuery('#iaa_interactionBubble [data-type="textfield"] [name="label"]').parent().addClass("has-error")}}if(jQuery("#iaa_interactionBubble").data("type")=="numberfield"){spanContent="1";title=iaa_data.txt_numberfield}if(jQuery("#iaa_interactionBubble").data("type")=="select"){spanClass="glyphicon glyphicon-th-list";title=iaa_data.txt_select;var values=new Array();jQuery('#iaa_interactionBubble [data-type="select"] .form-group input').each(function(){if(jQuery(this).val()!=""){values.push(jQuery(this).val())}})}if(jQuery("#iaa_interactionBubble").data("type")=="button"){spanClass="glyphicon glyphicon-hand-up";if(jQuery('#iaa_interactionBubble [data-type="button"] [name="label"]').val()==""){chkCreate=false;jQuery('#iaa_interactionBubble [data-type="button"] [name="label"]').parent().addClass("has-error")}}if(jQuery('#iaa_interactionBubble [name="itemID"]').val().length<3){chkCreate=false;jQuery('#iaa_interactionBubble [name="itemID"]').parent().addClass("has-error")}if(chkCreate){jQuery('#iaa_interactionBubble [data-type="'+type+'"] select,#iaa_interactionBubble [data-type="'+type+'"] input, #iaa_interactionBubble [data-type="'+type+'"] textarea').each(function(){eval("options."+jQuery(this).attr("name")+"= jQuery(this).val();");options.type=type});options.itemID=jQuery('#iaa_interactionBubble [name="itemID"]').val();if(jQuery("#iaa_interactionBubble").attr("data-item")&&jQuery("#iaa_interactionBubble").attr("data-item")!=""){iaa_currentStep.interactions[jQuery("#"+jQuery("#iaa_interactionBubble").attr("data-item")).index()]=options}else{iaa_createInteraction(options);jQuery("#iaa_stepPreview #iaa_avatarPreviewContainer #iaa_talkBubble").height((parseInt(jQuery("#iaa_stepPreview #iaa_avatarPreviewContainer #iaa_talkBubble").height())+48))}jQuery("#iaa_interactionBubble #iaa_interactionContent > div").slideUp();jQuery("#iaa_interactionBubble").fadeOut();iaa_previewStep()}}else{chkCreate=false;jQuery("#iaa_interactionBubble #iaa_interactionSelect").val("");jQuery("#iaa_interactionBubble #iaa_interactionContent > div").slideUp();jQuery("#iaa_interactionBubble").fadeOut()}}function iaa_startSelectElement(){if(jQuery("#iaa_websiteFrame").length>0){jQuery("#iaa_websiteFrame").remove();jQuery(".iaa_selectElementPanel").remove()}jQuery("body").append('<iframe id="iaa_websiteFrame" src="'+iaa_data.websiteUrl+'" onload="iaa_websiteFrameLoaded();"></iframe>');jQuery("#iaa_websiteFrame").hover(function(){jQuery("#iaa_websiteFrame").addClass("iaa_hover")},function(){jQuery("#iaa_websiteFrame").removeClass("iaa_hover")});jQuery("body").append('<div id="iaa_bootstraped" class="iaa_bootstraped iaa_selectElementPanel"></div>');jQuery(".iaa_selectElementPanel").hover(function(){jQuery(".iaa_selectElementPanel").addClass("iaa_hover")},function(){jQuery(".iaa_selectElementPanel").removeClass("iaa_hover")});jQuery(".iaa_selectElementPanel").html("<p>"+iaa_data.txt_selectStart+"</p>");jQuery(".iaa_selectElementPanel").append('<p><a href="javascript:" class="btn btn-primary" onclick="iaa_selectionSelectElement();">'+iaa_data.txt_selectBtn+'</a>&nbsp;&nbsp;<a href="javascript:" class="btn btn-danger" onclick="iaa_stopSelectElement();">'+iaa_data.txt_cancel+"</a></p>");jQuery("#iaa_loader").fadeIn();jQuery(".iaa_selectElementPanel").delay(500).fadeIn()}function iaa_selectionSelectElement(){jQuery(".iaa_selectElementPanel").html("<p>"+iaa_data.txt_selectSelection+"</p>");jQuery(".iaa_selectElementPanel").append('<p><a href="javascript:" class="btn btn-danger" onclick="iaa_stopSelectElement();">'+iaa_data.txt_cancel+"</a></p>");var a=jQuery("#iaa_websiteFrame")[0];var b=a.contentWindow||a.contentDocument;b.iaa_startSelection()}function iaa_confirmSelectElement(a){iaa_currentDomElement=a;jQuery(".iaa_selectElementPanel").html("<p>"+iaa_data.txt_selectConfirm+"</p>");jQuery(".iaa_selectElementPanel").append('<p><a href="javascript:" class="btn btn-primary" onclick="iaa_confirmedSelectElement();">'+iaa_data.txt_yes+'</a>&nbsp;&nbsp;<a href="javascript:" onclick="iaa_startSelectElement();" class="btn btn-danger">'+iaa_data.txt_no+"</a></p>")}function iaa_websiteFrameLoaded(){jQuery("#iaa_loader").fadeOut()}function iaa_stopSelectElement(){jQuery("#iaa_websiteFrame").fadeOut(250);jQuery(".iaa_selectElementPanel").fadeOut(250);setTimeout(function(){jQuery("#iaa_websiteFrame").remove();jQuery(".iaa_selectElementPanel").remove()},300)}function iaa_confirmedSelectElement(){var a=iaa_getPath(iaa_currentDomElement);jQuery('#iaa_actionContent input[name="element"]').val(a);jQuery('#iaa_actionContent input[name="url"]').val(jQuery("#iaa_websiteFrame").contents().get(0).location.href);iaa_stopSelectElement();jQuery("#iaa_actionElementSelected").fadeIn();jQuery("#iaa_actionBubble").fadeIn()}function iaa_getPath(a){var b="";if(jQuery(a).length>0&&typeof(jQuery(a).prop("tagName"))!="undefined"){if(!jQuery(a).attr("id")||jQuery(a).attr("id").substr(0,8)=="ultimate"){b=">"+jQuery(a).prop("tagName")+":nth-child("+(jQuery(a).index()+1)+")"+b;b=iaa_getPath(jQuery(a).parent())+b}else{b+="#"+jQuery(a).attr("id")}}return b}function iaa_saveStep(){iaa_currentStep.bubbleWidth=jQuery("#iaa_stepPreview #iaa_talkBubble").innerWidth();iaa_currentStep.bubbleHeight=jQuery("#iaa_stepPreview #iaa_talkBubble").innerHeight();iaa_previewStep();jQuery("#iaa_stepTitle").parent().removeClass("has-error");iaa_currentStep.title=jQuery("#iaa_stepTitle").val();iaa_currentStep.text=jQuery("#iaa_stepText").val();iaa_currentStep.title=iaa_currentStep.title.replace(/\"/g,"'");iaa_currentStep.text=iaa_currentStep.text.replace(/\"/g,"'");iaa_currentStep.text=iaa_currentStep.text.replace(/\r?\n/g,"<br />");if(jQuery("#iaa_stepTitle").val()==""){jQuery("#iaa_stepTitle").parent().addClass("has-error")}else{var a=new Array();jQuery.each(iaa_defaultStep.interactions,function(){var b=this;if(jQuery("#"+b.elementID).length==0){a.push(b.elementID)}});jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_saveStep",step:JSON.stringify(iaa_currentStep),removedInter:a},success:function(b){iaa_currentStep.id=b;iaa_closeWin(jQuery("#iaa_winStep"));iaa_loadSteps()}})}}function iaa_removeAllSteps(){jQuery.ajax({url:ajaxurl,type:"post",data:{action:"iaa_removeAllSteps"},success:function(){iaa_loadSteps()}})}function iaa_previewStep(){if(jQuery("#iaa_stepPreview #iaa_talkBubble").length>0){jQuery("#iaa_stepPreview #iaa_talkBubble").remove()}var a=jQuery("#iaa_stepText").val();a=a.replace(/\[b\]/g,"<strong>").replace(/\[\/b\]/g,"</strong>");a=a.replace(/\[u\]/g,"<u>").replace(/\[\/u\]/g,"</u>");a=a.replace(/\r?\n/g,"<br />");var b=jQuery('<div id="iaa_talkBubble"><div id="iaa_bubbleContent"></div></div>');b.find("#iaa_bubbleContent").append('<div class="iaa_talkText"><p>'+a+"</p></div>");b.resizable({maxHeight:260,maxWidth:680,minHeight:32,minHeight:32,minWidth:180,stop:function(){iaa_currentStep.bubbleWidth=jQuery("#iaa_stepPreview #iaa_talkBubble").innerWidth();iaa_currentStep.bubbleHeight=jQuery("#iaa_stepPreview #iaa_talkBubble").innerHeight();setTimeout(function(){jQuery("#wpwrap").css({height:jQuery("#iaa_winStep").height()+48})},250)}});if(iaa_currentStep.bubbleWidth){b.css({width:iaa_currentStep.bubbleWidth+"px",height:iaa_currentStep.bubbleHeight+"px"})}var e="";var c="";var d=new Array();jQuery.each(iaa_currentStep.interactions,function(g){var f=this;if(jQuery.inArray(this,d)<0){d.push(f)}else{iaa_currentStep.interactions.splice(jQuery.inArray(iaa_currentStep.interactions[g],iaa_currentStep.interactions),1)}});jQuery.each(iaa_currentStep.interactions,function(){var h=this;lastElementID=h.elementID;switch(h.type){case"button":c+='<a href="javascript:" class="iaa_btn">'+h.label+"</a>";break;case"textfield":e+='<div class="iaa_field"><label>'+h.label+'</label><input type="text" data-valisation="'+h.validation+'" /></div>';break;case"numberfield":var i="";if(h.decimals==1){i='step="any"'}e+='<div class="iaa_field" data-type="numberfield" data-id="'+h.itemID+'" data-validation="'+h.validation+'"><label>'+h.label+'</label><input type="number" '+i+' value="'+h.min+'" min="'+h.min+'" max="'+h.max+'"  /></div>';break;case"select":var g=new Array();var f="<select>";jQuery.each(h,function(j){if(j.substr(0,2)=="s_"){if(this!=""){g.push(this);f+='<option value="'+this+'">'+this+"</option>"}}});f+="</select>";e+='<div class="iaa_field" data-type="select" data-id="'+h.itemID+'"><label>'+h.label+"</label>"+f+"</div>";break}});e+='<p class="iaa_btns">'+c+"</p>";b.find("#iaa_bubbleContent").append('<div class="iaa_talkInteraction">'+e+"</div>");jQuery("#iaa_stepPreview #iaa_avatarPreviewContainer").append(b);b.css({bottom:parseInt(b.closest(".iaa_avatarContainer").css("height"))+13});jQuery("#iaa_stepPreview").animate({height:b.height()+parseInt(b.css("bottom"))+40},350);b.fadeIn()};