jQuery(document).ready(function(R){var af=R(window),j=R(document),H=R("body"),D=R("#mailster_iframe"),Z=R("#template-wrap"),ad,s,C=R("#mailster_template .inside"),f=!!R("#mailster_disabled").val(),W=R("#title"),O=R("#mailster_subject"),ab=R("#mailster_preheader"),Y=R("#content"),b=R("#excerpt"),ac=R("#modules"),ae=R("#plain-text-wrap"),N=R("#html-wrap"),u=R("#head"),y=R("#optionbar"),J=[],X=R("#post_ID").val(),ao=0,c=R("#clickmap-stats"),V=R('[name^="mailster_data"]'),G=R("#mailster_nonce").val(),I=false,aj,F,t,K,h,m,M,ag=R("html,body"),g="WebkitAppearance" in document.documentElement.style,l=(/firefox/i).test(navigator.userAgent),k=(/msie|trident/i).test(navigator.userAgent),A,p,al=false,z="ontouchstart" in document.documentElement,o=typeof tinymce=="object",P,E={mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},tabMode:"indent",lineNumbers:true,viewportMargin:Infinity,autofocus:true};function ak(){a("disable");ah();s=(D[0].contentWindow||D[0].contentDocument);if(s.document){s=s.document}aa();var ar=setTimeout(function(){if(!I){D.trigger("load")}},5000);window.Mailster=window.Mailster||{refresh:function(){a("refresh")},save:function(){a("save")},trigger:a,autosave:""};D.on("load",function(){if(I){return false}if(!f){if(!h){h=new ai()}if(!M){M=new aq()}if(!K){K=new ap()}window.Mailster.editbar=M}else{}a("enable");I=true;clearInterval(ar);ad=D.contents().find("body");if(f){window.autosave=wp.autosave=function(){return true};window.onbeforeunload=null;ad.on("click","a",function(){window.open(this.href);return false})}else{}a("resize");a("refresh");if(!Y.val()){a("save")}R("#normal-sortables").on("sortupdate",function(at,au){a("resize")});Z.removeClass("load");J.push(B())});af.on("resize.mailster",function(){a("refresh")});if(/post_status=autoresponder/.test(R("#referredby").val())||/post_status=autoresponder/.test(location.search)){R("#mailster_delivery").find('a[href="#autoresponder"]').click()}if(k){H.addClass("ie")}if(z){H.addClass("touch")}}function aa(){j.on("click","a.external",function(){window.open(this.href);return false}).on("change","input[name=screen_columns]",function(){a("resize")});R("#mailster_submitdiv").on("change","#use_pwd",function(){R("#password-wrap").slideToggle(200).find("input").focus().select();R("#post_password").prop("disabled",!R(this).is(":checked"))});if(!f){j.on("heartbeat-send",function(at,ar){if(ar&&ar.wp_autosave){ar.wp_autosave["content"]=i();ar.wp_autosave["excerpt"]=b.val();ar.mailsterdata=V.serialize()}}).on("click",".restore-backup",function(at,ar){var ar=wp.autosave.local.getSavedPostData();U(ar.content);W.val(ar.post_title);a("refresh");return false}).on("change",".dynamic_embed_options_taxonomy",function(){var ar=R(this),at=ar.val();ar.parent().find(".button").remove();if(at!=-1){if(ar.parent().find("select").length<ar.find("option").length-1){R(' <a class="button button-small add_embed_options_taxonomy">'+mailsterL10n.add+"</a>").insertAfter(ar)}}else{ar.parent().html("").append(ar)}return false}).on("click",".add_embed_options_taxonomy",function(){var at=R(this),ar=at.prev().clone();ar.insertBefore(at).val("-1");R("<span> "+mailsterL10n.or+" </span>").insertBefore(ar);at.remove();return false});W.on("change",function(){if(!O.val()){O.val(R(this).val())}});R("#mailster_submitdiv").on("#post","submit",function(){if(al){return false}a("save")}).on("click",".sendnow-button",function(){if(!confirm(mailsterL10n.send_now)){return false}});R("#mailster_delivery").on("change","input.timezone",function(){R(".active_wrap").toggleClass("timezone-enabled")}).on("change","input.autoresponder-timezone",function(){R(".autoresponderfield-mailster_autoresponder_timebased").toggleClass("timezone-enabled")}).on("change","input.userexactdate",function(){var ar=R(this).parent().parent().parent();ar.find("span")._Class("disabled")}).on("change","#autoresponder-post_type",function(){var ar=R("#autoresponder-taxonomies");ar.find("select").prop("disabled",true);S("get_post_term_dropdown",{labels:false,names:true,posttype:R(this).val()},function(at){if(at.success){ar.html(at.html)}},function(at,av,au){loader(false)})}).on("click",".category-tabs a",function(){var at=R(this),ar=at.attr("href");R("#mailster_delivery").find(".tabs-panel").hide();R("#mailster_delivery").find(".tabs").removeClass("tabs");at.parent().addClass("tabs");R(ar).show();R("#mailster_is_autoresponder").val((ar=="#autoresponder")?1:"");return false}).on("click",".mailster_sendtest",function(){var at=R(this),ar=R("#delivery-ajax-loading").css("display","inline");at.prop("disabled",true);a("save");S("send_test",{formdata:R("#post").serialize(),to:R("#mailster_testmail").val(),content:Y.val(),head:u.val(),plaintext:b.val()},function(au){ar.hide();at.prop("disabled",false);var av=R('<div class="'+((!au.success)?"error":"updated")+'"><p>'+au.msg+"</p></div>").hide().prependTo(at.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){av.remove()})},function(au,ax,av){ar.hide();at.prop("disabled",false);var aw=R('<div class="error"><p>'+ax+" "+au.status+": "+av+"</p></div>").hide().prependTo(at.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aw.remove()})})}).on("change","#mailster_data_active",function(){(R(this).is(":checked"))?R(".active_wrap").addClass("disabled"):R(".active_wrap").removeClass("disabled");R(".deliverydate, .deliverytime").prop("disabled",!R(this).is(":checked"))}).on("change","#mailster_data_autoresponder_active",function(){(R(this).is(":checked"))?R(".autoresponder_active_wrap").addClass("disabled"):R(".autoresponder_active_wrap").removeClass("disabled")}).on("click",".mailster_spamscore",function(){var aw=R(this),ar=R("#delivery-ajax-loading").css("display","inline"),av=R("#spam_score_progress").removeClass("spam-score").slideDown(200),au=av.find(".bar");aw.prop("disabled",true);R(".score").html("");a("save");au.css("width","20%");S("send_test",{spamtest:true,formdata:R("#post").serialize(),to:R("#mailster_testmail").val(),content:Y.val(),head:u.val(),plaintext:b.val()},function(ax){if(ax.success){au.css("width","40%");at(ax.id,1)}else{ar.hide();av.slideUp(200);var ay=R('<div class="error"><p>'+ax.msg+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ay.remove()})}},function(ax,aA,ay){ar.hide();aw.prop("disabled",false);var az=R('<div class="error"><p>'+aA+" "+ax.status+": "+ay+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){az.remove()})});function at(ay,ax){S("check_spam_score",{ID:ay},function(aA){if(aA.score){ar.hide();aw.prop("disabled",false);av.addClass("spam-score");au.css("width",(parseFloat(aA.score)*10)+"%");R(".score").html("<strong>"+x(mailsterL10n.yourscore,aA.score)+"</strong>:<br>"+mailsterL10n.yourscores[Math.floor((aA.score/10)*mailsterL10n.yourscores.length)])}else{if(ax<=5&&!aA.abort){var az=(ax*10)+50;au.css("width",(az)+"%");setTimeout(function(){at(ay,++ax)},ax*400)}else{ar.hide();aw.prop("disabled",false);au.css("width","100%");av.slideUp(200);var aB=R('<div class="error"><p>'+aA.msg+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aB.remove();au.css("width",0)})}}},function(az,aC,aA){ar.hide();aw.prop("disabled",false);var aB=R('<div class="error"><p>'+aC+" "+az.status+": "+aA+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aB.remove()})})}}).on("blur","input.deliverytime",function(){j.unbind(".mailster_deliverytime")}).on("focus, click","input.deliverytime",function(aw){var ax=R(this),at=R(this)[0],ar=ax.offset().left,ay=0,av=0,au=2;if(aw.clientX-ar>23){ay=1,av=3,au=5}j.unbind(".mailster_deliverytime").on("keypress.mailster_deliverytime",function(az){if(az.keyCode==9){return(ay=!ay)?!p(at,3,5):(az.shiftKey)?!p(at,0,2):true}}).on("keyup.mailster_deliverytime",function(az){if(ax.val().length==1){ax.val(ax.val()+":00");p(at,1,1)}if(document.activeElement.selectionStart==2){if(ax.val().substr(0,2)>23){ax.trigger("change");return false}p(at,3,5)}});p(at,av,au)}).on("change","input.deliverytime",function(){var at=R(this),au=at.val(),ar;at.addClass("inactive");if(!/^\d+:\d+$/.test(au)){if(au.length==1){au="0"+au+":00"}else{if(au.length==2){au=au+":00"}else{if(au.length==3){au=au.substr(0,2)+":"+au.substr(2,3)+"0"}else{if(au.length==4){au=au.substr(0,2)+":"+au.substr(2,4)}}}}}ar=au.split(":");if(!/\d\d:\d\d$/.test(au)&&au!=""||ar[0]>23||ar[1]>59){at.val("00:00").focus();p(at[0],0,2)}else{at.val(au)}}).on("change","#mailster_autoresponder_action",function(){R("#autoresponder_wrap").removeAttr("class").addClass("autoresponder-"+R(this).val())}).on("change","#time_extra",function(){R("#autoresponderfield-mailster_timebased_advanced").slideToggle()}).on("click",".mailster_autoresponder_timebased-end-schedule",function(){(R(this).is(":checked"))?R(".mailster_autoresponder_timebased-end-schedule-field").slideDown():R(".mailster_autoresponder_timebased-end-schedule-field").slideUp()}).on("change",".mailster-action-hooks",function(){var ar=R(this).val();R(".mailster-action-hook").val(ar);if(!ar){R(".mailster-action-hook").focus()}}).on("change",".mailster-action-hook",function(){var ar=R(this).val();if(!R(".mailster-action-hooks option[value='"+ar+"']").length){R(".mailster-action-hooks").append("<option>"+ar+"</option>")}R(".mailster-action-hooks").val(ar)}).on("click",".mailster-total",function(){a("updateCount")}).on("change","#list_extra",function(){if(R(this).is(":checked")){R("#mailster_list_advanced").slideDown()}else{R("#mailster_list_advanced").slideUp()}R("#list-checkboxes").find("input.list").eq(0).trigger("change")}).on("focus","input.datepicker",function(){R(this).removeClass("inactive").trigger("click")}).on("blur","input.datepicker",function(){R(".deliverydate").html(R(this).val());R(this).addClass("inactive")}).on("change","input.datepicker",function(){});R("#mailster_details").on("click",".default-value",function(){var ar=R(this);R("#"+ar.data("for")).val(ar.data("value"))});R("input.color").wpColorPicker({color:true,width:250,mode:"hsl",palettes:R(".colors").data("original-colors"),change:function(ar,at){R(this).val(at.color.toString()).trigger("change")},clear:function(ar,at){}});R(".mailster-preview-iframe").on("load",function(){var au=R(this),at=au.contents(),ar=at.find("body");ar.on("click","a",function(){var av=R(this).attr("href");if(av&&av!="#"){window.open(av)}return false})});if(typeof jQuery.datepicker=="object"){R("#mailster_delivery").find("input.datepicker").datepicker({dateFormat:"yy-mm-dd",minDate:new Date(),firstDay:mailsterL10n.start_of_week,showWeek:true,dayNames:mailsterL10n.day_names,dayNamesMin:mailsterL10n.day_names_min,monthNames:mailsterL10n.month_names,prevText:mailsterL10n.prev,nextText:mailsterL10n.next,showAnim:"fadeIn",onClose:function(){var ar=R(this).datepicker("getDate");R(".deliverydate").html(R(this).val())}});R("input.datepicker.nolimit").datepicker("option","minDate",null)}else{R("#mailster_delivery").find("input.datepicker").prop("readonly",false)}R("#mailster_attachments").on("click",".delete-attachment",function(ar){ar.preventDefault();R(this).parent().remove()}).on("click",".add-attachment",function(ar){ar.preventDefault();if(!wp.media.frames.mailster_attachments){wp.media.frames.mailster_attachments=wp.media({title:mailsterL10n.add_attachment,button:{text:mailsterL10n.add_attachment},multiple:false});wp.media.frames.mailster_attachments.on("select",function(){var au=wp.media.frames.mailster_attachments.state().get("selection").first().toJSON(),at=R(".mailster-attachment").eq(0).clone();at.find("img").attr("src",au.icon);at.find(".mailster-attachment-label").html(au.filename);at.find("input").attr("name","mailster_data[attachments][]").val(au.id);at.appendTo(".mailster-attachments")})}wp.media.frames.mailster_attachments.open()});R("#mailster_receivers").on("change","input.list",function(){a("updateCount")}).on("change","#all_lists",function(){R("#list-checkboxes").find("input.list").prop("checked",R(this).is(":checked"));a("updateCount")}).on("change","#ignore_lists",function(){var ar=R(this).is(":checked");R("#list-checkboxes").each(function(){(ar)?R(this).slideUp(200):R(this).slideDown(200)}).find("input.list");a("updateCount")}).on("click",".edit-conditions",function(){tb_show(mailsterL10n.edit_conditions,"#TB_inline?x=1&width=720&height=520&inlineId=receivers-dialog",null);return false}).on("click",".remove-conditions",function(){if(confirm(mailsterL10n.remove_conditions)){R("#receivers-dialog").find(".mailster-conditions-wrap").empty();a("updateCount")}return false}).on("click",".mailster-total",function(){a("updateCount")});R(".close-conditions").on("click",tb_remove);R("#mailster_options").on("click",".wp-color-result",function(){R(this).closest("li.mailster-color").addClass("open")}).on("click","a.default-value",function(){var at=R(this).prev().find("input"),ar=at.data("default");at.wpColorPicker("color",ar);return false}).on("click","ul.colorschema",function(){var at=R("#mailster_options").find("input.color"),ar=R(this).find("li.colorschema-field");a("disable");R.each(ar,function(av){var au=ar.eq(av).data("hex");at.eq(av).wpColorPicker("color",au)});a("enable")}).on("click","a.savecolorschema",function(){var at=R.map(R("#mailster_options").find(".color"),function(au){return R(au).val()});var ar=R("#colorschema-ajax-loading").css("display","inline");S("save_color_schema",{template:R("#mailster_template_name").val(),colors:at},function(au){ar.hide();if(au.success){R(".colorschema").last().after(R(au.html).hide().fadeIn())}},function(au,aw,av){ar.hide()})}).on("click",".colorschema-delete",function(){if(confirm(mailsterL10n.delete_colorschema)){var at=R(this).parent().parent();var ar=R("#colorschema-ajax-loading").css({display:"inline"});S("delete_color_schema",{template:R("#mailster_template_name").val(),hash:at.data("hash")},function(au){ar.hide();if(au.success){at.fadeOut(100,function(){at.remove()})}},function(au,aw,av){ar.hide()})}return false}).on("click",".colorschema-delete-all",function(){if(confirm(mailsterL10n.delete_colorschema_all)){var at=R(".colorschema.custom");var ar=R("#colorschema-ajax-loading").css({display:"inline"});S("delete_color_schema_all",{template:R("#mailster_template_name").val()},function(au){ar.hide();if(au.success){at.fadeOut(100,function(){at.remove()})}},function(au,aw,av){ar.hide()})}return false}).on("change","#mailster_version",function(){var ar=R(this).val();L(ar)}).on("change","input.color",function(){var at=R(this);var ar=at.data("value");Q(ar,at.val(),at)});R("#mailster_template").on("click","a.getplaintext",function(){var ar=b.val();b.val(mailsterL10n.loading);S("get_plaintext",{html:i()},function(at){b.val(at)},function(at,av,au){b.val(ar)},"HTML")}).on("change","#plaintext",function(){var ar=R(this).is(":checked");b.prop("disabled",ar)[ar?"addClass":"removeClass"]("disabled")})}else{if(typeof autosavePeriodical!="undefined"){autosavePeriodical.repeat=false}R("#mailster_details").on("click","#show_recipients",function(){var au=R(this),at=R("#recipients-list"),ar=R("#recipients-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_recipients",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide()});return false}).on("click","#show_clicks",function(){var au=R(this),at=R("#clicks-list"),ar=R("#clicks-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_clicks",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide()});return false}).on("click","#show_environment",function(){var au=R(this),at=R("#environment-list"),ar=R("#environment-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_environment",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide()});return false}).on("click","#show_geolocation",function(){var au=R(this),at=R("#geolocation-list"),ar=R("#geolocation-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_geolocation",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100,function(){var az,aA,aC={legend:false,region:"world",resolution:"countries",datalessRegionColor:"#ffffff",enableRegionInteractivity:true,colors:["#d7f1fc","#2BB3E7"],backgroundColor:{fill:"none",stroke:null,strokeWidth:0}},ay;var aE;google.load("visualization","1.0",{packages:["geochart","corechart"],callback:function(){aE=new google.visualization.GeoChart(document.getElementById("countries_map"));az=aA=google.visualization.arrayToDataTable(av.countrydata);if(location.hash&&(ay=location.hash.match(/region=([A-Z]{2})/))){aw(ay[1])}else{aD()}google.visualization.events.addListener(aE,"regionClick",aw)}});R("a.zoomout").on("click",function(){ax();return false});R("#countries_table").find("tbody").find("tr").on("click",function(){var aF=R(this).data("code");(aF=="unknown"||!aF)?ax():aw(aF);return false});function ax(){var aF={region:"world",displayMode:"region",resolution:"countries",colors:["#D7E4E9","#2BB3E7"]};az=aA;aD(aF);R("#countries_table").find("tr").removeClass("wp-ui-highlight");R("#mapinfo").hide();location.hash="#region="}function aw(aG){var aF={},aH=aG.region?aG.region:aG,aI;if(aH.match(/-/)){return false}aF.region=aH;(av.unknown_cities[aH])?R("#mapinfo").show().html("+ "+av.unknown_cities[aH]+" unknown locations"):R("#mapinfo").hide();aI=av.geodata[aH]?av.geodata[aH]:[];aF.resolution="provinces";aF.displayMode="markers";aF.dataMode="markers";aF.colors=["#4EBEE9","#2BB3E7"];az=new google.visualization.DataTable();az.addColumn("number","Lat");az.addColumn("number","Long");az.addColumn("string","tooltip");az.addColumn("number","Value");az.addColumn({type:"string",role:"tooltip"});az.addRows(aI);R("#countries_table").find("tr").removeClass("wp-ui-highlight");R("#country-row-"+aH).addClass("wp-ui-highlight");location.hash="#region="+aH;aD(aF)}function aD(aF){aF=R.extend(aC,aF);aE.draw(az,aF);R("a.zoomout").css({visibility:(aC.region!="world"?"visible":"hidden")})}function aB(aG){var aF=aG;R.each(regions,function(aH,aI){if(R.inArray(aG,aI)!=-1){aF=aH}});return aF}})},function(av,ax,aw){ar.hide()});return false}).on("click","#show_errors",function(){var au=R(this),at=R("#error-list"),ar=R("#error-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_errors",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide()});return false}).on("click","#show_countries",function(){R("#countries_wrap").toggle();return false});R("#mailster_details").on("click",".load-more-receivers",function(){var ax=R(this),aw=ax.data("page"),au=ax.data("types"),av=ax.data("orderby"),at=ax.data("order"),ar=ax.next().css({display:"inline"});S("get_recipients_page",{id:X,types:au,page:aw,orderby:av,order:at},function(ay){ar.hide();if(ay.success){ax.parent().parent().replaceWith(ay.html)}},function(ay,aA,az){detailbox.removeClass("loading")});return false}).on("click",".recipients-limit",function(ar){if(ar.altKey){R("input.recipients-limit").prop("checked",false);R(this).prop("checked",true)}}).on("change",".recipients-limit, select.recipients-order",function(av){var ax=R("#recipients-list"),at=R("#recipients-ajax-loading"),au=R("input.recipients-limit:checked").map(function(){return this.value}).get(),aw=R("select.recipients-order").val(),ar=R("a.recipients-order").hasClass("asc")?"ASC":"DESC";at.css({display:"inline"});R("input.recipients-limit").prop("disabled",true);S("get_recipients",{id:X,types:au.join(","),orderby:aw,order:ar},function(ay){at.hide();R("input.recipients-limit").prop("disabled",false);ax.html(ay.html).slideDown(100)},function(ay,aA,az){at.hide()});return false}).on("click","a.recipients-order",function(){R(this).toggleClass("asc");R("select.recipients-order").trigger("change")}).on("click",".show-receiver-detail",function(){var ar=R(this),au=ar.data("id"),at=R("#receiver-detail-"+au).show();ar.parent().addClass("loading").parent().addClass("expanded");S("get_recipient_detail",{id:au,campaignid:X},function(av){ar.parent().removeClass("loading");if(av.success){at.find("div.receiver-detail-body").html(av.html).slideDown(100)}},function(av,ax,aw){at.removeClass("loading")});return false}).on("click","#stats label",function(){R("#recipients-list").find("input").prop("checked",false).filter("input."+R(this).attr("class")).prop("checked",true).trigger("change")});C.on("mouseenter","a.clickbadge",function(){var ax=R(this),ar=ax.position(),aw=ax.data("p"),av=ax.data("link"),at=ax.data("clicks"),au=ax.data("total");c.find(".piechart").data("easyPieChart").update(aw);c.find(".link").html(av);c.find(".clicks").html(at);c.find(".total").html(au);c.stop().fadeIn(100).css({top:ar.top-85,left:ar.left-(c.width()/2-ax.width()/2)})}).on("mouseleave","a.clickbadge",function(){c.stop().fadeOut(400)});R("#mailster_receivers").on("click",".create-new-list",function(){var ar=R(this).hide();R(".create-new-list-wrap").slideDown();R(".create-list-type").trigger("change");return false}).on("click",".create-list",function(){var av=R(this),au=R(".create-list-type"),at="",ar=R(".mailster-total");if(au.val()==-1){return false}if(at=prompt(mailsterL10n.enter_list_name,x(mailsterL10n.create_list,au.find(":selected").text(),R("#title").val()))){ar.addClass("loading");S("create_list",{name:at,listtype:au.val(),id:X},function(aw){ar.removeClass("loading");var ax=R('<div class="'+((!aw.success)?"error":"updated")+'"><p>'+aw.msg+"</p></div>").hide().prependTo(R(".create-new-list-wrap")).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ax.remove()})},function(aw,ay,ax){ar.removeClass("loading")})}return false}).on("change",".create-list-type",function(){var at=R(this),ar=R(".mailster-total");if(at.val()==-1){return false}at.prop("disabled",true);ar.addClass("loading");S("get_create_list_count",{listtype:at.val(),id:X},function(au){at.prop("disabled",false);ar.removeClass("loading").html(au.count)},function(au,aw,av){at.prop("disabled",false);ar.removeClass("loading").html("")})}).on("click",".mailster-total",function(){R(".create-list-type").trigger("change")});R(".piechart").easyPieChart({animate:2000,rotate:180,barColor:"#2BB3E7",trackColor:"#f3f3f3",lineWidth:9,size:75,lineCap:"butt",onStep:function(ar){this.$el.find("span").text(Math.round(ar))},onStop:function(ar){this.$el.find("span").text(Math.round(ar))}});j.on("heartbeat-send",function(at,ar){if(ar.wp_autosave){delete ar.wp_autosave}ar.mailster={page:"edit",id:X}}).on("heartbeat-tick",function(ay,aw){if(!aw.mailster[X]){return}var au=aw.mailster[X],at=R("#stats").find(".verybold"),av=R("#stats").find(".piechart"),ar=R(".progress"),ax=(au.sent/au.total*100);R(".hb-sent").html(au.sent_f);R(".hb-opens").html(au.opens_f);R(".hb-clicks").html(au.clicks_f);R(".hb-clicks_total").html(au.clicks_total_f);R(".hb-unsubs").html(au.unsubs_f);R(".hb-bounces").html(au.bounces_f);R(".hb-geo_location").html(au.geo_location);R.each(au.environment,function(az){R(".hb-"+az).html((this.percentage*100).toFixed(2)+"%")});if(R("#stats_opens").length){R("#stats_opens").data("easyPieChart").update(Math.round(au.open_rate))}if(R("#stats_clicks").length){R("#stats_clicks").data("easyPieChart").update(Math.round(au.click_rate))}if(R("#stats_unsubscribes").length){R("#stats_unsubscribes").data("easyPieChart").update(Math.round(au.unsub_rate))}if(R("#stats_bounces").length){R("#stats_bounces").data("easyPieChart").update(Math.round(au.bounce_rate))}ar.find(".bar").width(ax+"%");ar.find("span").eq(1).html(au.sent_formatted);ar.find("var").html(Math.round(ax)+"%");e(au.clickbadges);if(au.status!=R("#original_post_status").val()&&!R("#mailster_status_changed_info").length){R('<div id="mailster_status_changed_info" class="error inline"><p>'+x(mailsterL10n.statuschanged,'<a href="post.php?post='+X+'&action=edit">'+mailsterL10n.click_here+"</a></p></div>")).hide().prependTo("#postbox-container-2").slideDown(200)}});if(typeof wp!="undefined"&&wp.heartbeat){wp.heartbeat.interval("fast")}}}var ai=function(){var av=C.offset();function aG(){y.on("click","a.template",aE).on("click","a.save-template",aC).on("click","a.clear-modules",ay).on("click","a.preview",aA).on("click","a.undo",aF).on("click","a.redo",aB).on("click","a.code",aw).on("click","a.plaintext",ax).on("click","a.dfw",ar).on("click","a.file",at);H.on("click","button.save-template",aD).on("click","button.save-template-cancel",tb_remove);af.on("scroll.optionbar",function(){var aH=af.scrollTop();if(aH<av.top-50||aH>av.top+C.height()-120){if(/fixed-optionbar/.test(H[0].className)){H.removeClass("fixed-optionbar")}y.width("auto")}else{if(!/fixed-optionbar/.test(H[0].className)){H.addClass("fixed-optionbar")}y.width(C.width())}}).on("resize.optionbar",function(){av=C.offset();af.trigger("scroll.optionbar")})}function aC(){tb_show(mailsterL10n.save_template,"#TB_inline?x=1&width=480&height=320&inlineId=mailster_template_save",null);R("#new_template_name").focus().select();return false}function aD(){a("disable");var aK=R("#new_template_name").val();if(!aK){return false}a("save");var aH=R("#new_template-ajax-loading").css("display","inline"),aJ=R("#new_template_modules").is(":checked"),aN=R("#new_template_active_modules").is(":checked"),aL=R("#new_template_saveas_dropdown").val(),aI=!!parseInt(R('input[name="new_template_overwrite"]:checked').val(),10),aM=i();S("create_new_template",{name:aK,modules:aJ,activemodules:aN,overwrite:aI?aL:false,template:R("#mailster_template_name").val(),content:aM,head:u.val()},function(aO){aH.hide();if(aO.success){if(window.wp){window.wp=null}window.location=aO.url}else{alert(aO.msg)}},function(aO,aQ,aP){aH.hide()});return false}function aF(){if(ao){ao--;U(J[ao],100,false);Y.val(J[ao]);a("refresh");y.find("a.redo").removeClass("disabled");if(!ao){R(this).addClass("disabled")}}return false}function aB(){var aH=J.length;if(ao<aH-1){ao++;U(J[ao],100,false);Y.val(J[ao]);a("refresh");y.find("a.undo").removeClass("disabled");if(ao>=aH-1){R(this).addClass("disabled")}}return false}function ay(){if(confirm(mailsterL10n.remove_all_modules)){var aH=D.contents().find("module");var aI=D.contents().find("modules");aI.slideUp(function(){aH.remove();aI.html("").show();a("refresh");a("save")})}return false}function aA(){a("save");var aL=R(this),aJ=i(),aI=O.val(),aH=ab.val(),aK=W.val();if(y.find("a.preview").is(".loading")){return false}y.find("a.preview").addClass("loading");S("set_preview",{id:X,content:aJ,head:u.val(),issue:R("#mailster_autoresponder_issue").val(),subject:aI,preheader:aH},function(aM){y.find("a.preview").removeClass("loading");R(".mailster-preview-iframe").attr("src",ajaxurl+"?action=mailster_get_preview&hash="+aM.hash+"&_wpnonce="+aM.nonce);tb_show((aK?x(mailsterL10n.preview_for,'"'+aK+'"'):mailsterL10n.preview),"#TB_inline?hash="+aM.hash+"&_wpnonce="+aM.nonce+"&width="+(Math.min(1200,af.width()-50))+"&height="+(af.height()-100)+"&inlineId=mailster_campaign_preview",null)},function(aM,aO,aN){y.find("a.preview").removeClass("loading")})}function az(){y.remove()}function au(){R("#new_template_name").on("focus",function(){j.unbind("keypress.mailster").bind("keypress.mailster",function(aH){if(aH.keyCode==13){aD();return false}})}).select().focus().on("blur",function(){j.unbind("keypress.mailster")})}function aE(aH){var aI=R(this);aI.parent().find("ul").eq(0).slideToggle(100);return false}function aw(){var aI=!D.is(":visible");var aH;if(!aI){aH=n(B());y.find("a.code").addClass("loading");a("disable");S("toggle_codeview",{bodyattributes:aH.parts[2],content:aH.content,head:aH.head},function(aJ){y.find("a.code").addClass("active").removeClass("loading");N.hide();Y.val(aJ.content);y.find("a").not("a.redo, a.undo, a.code").addClass("disabled");P=CodeMirror.fromTextArea(Y.get(0),E)},function(aJ,aL,aK){y.find("a.code").addClass("active").removeClass("loading");a("enable")})}else{aH=n(P.getValue());P.clearHistory();y.find("a.code").addClass("loading");a("disable");S("toggle_codeview",{bodyattributes:aH.parts[2],content:aH.content,head:aH.head},function(aJ){U(aJ.content,100,true);N.show();Y.hide();R(".CodeMirror").remove();y.find("a.code").removeClass("active").removeClass("loading");y.find("a").not("a.redo, a.undo, a.code").removeClass("disabled");a("enable");a("refresh")},function(aJ,aL,aK){y.find("a.code").addClass("active").removeClass("loading");a("enable")})}return false}function ax(){var aH=!D.is(":visible");if(!aH){y.find("a.plaintext").addClass("active");N.hide();b.show();ae.show();y.find("a").not("a.redo, a.undo, a.plaintext, a.preview").addClass("disabled")}else{N.show();ae.hide();y.find("a.plaintext").removeClass("active");y.find("a").not("a.redo, a.undo, a.plaintext, a.preview").removeClass("disabled");a("refresh")}return false}function ar(aH){if(aH.type=="mouseout"&&!/DIV|H3/.test(aH.target.nodeName)){return}av=C.offset();if(!H.hasClass("focus-on")){H.removeClass("focus-off").addClass("focus-on");R("#wpbody").on("mouseleave.dfw",ar);y.find("a.dfw").addClass("active");if(af.scrollTop()<av.top){d(av.top-80)}}else{H.removeClass("focus-on").addClass("focus-off");R("#wpbody").off("mouseleave",ar);y.find("a.dfw").removeClass("active")}return false}function at(aH){window.onbeforeunload=null}aG();return{hide:function(){az()}}};var aq=function(){var bj=R("#editbar"),aR,ba={img:0,single:80,multi:0,btn:0,auto:0,codeview:0},a9=bj.find(".imagepreview"),aM=bj.find(".imagewidth"),aI=bj.find(".imageheight"),aw=bj.find(".imagecrop"),br=bj.find(".factor"),bb=bj.find(".highdpi"),a1=bj.find(".original"),aG=bj.find(".imagelink"),bu=bj.find(".imageurl"),bx=bj.find(".orgimageurl"),ay=bj.find(".imagealt"),bc=bj.find(".singlelink"),bt=bj.find(".buttonlink"),aW=bj.find(".buttonlabel"),aF=bj.find(".buttonalt"),aL=bj.find(".button-nav"),bw=bj.find("ul.buttons"),be,aS,bl,bo,ax,bk,aK,aB,aV,aE,aC,aD="x",au="",ar=R("#wp-mailster-editor-wrap"),bh=R("#post-search"),av=R("#image-search");function bq(){bj.on("keyup change","input.live",at).on("keyup change","#mailster-editor",at).on("click",".replace-image",a6).on("change",".highdpi",a0).on("click","button.save",aQ).on("click",".cancel",aA).on("click","a.remove",aY).on("click","a.reload",bn).on("click","a.single-link-content",aU).on("click","a.add_image",a5).on("click","a.add_image_url",aJ).on("click",".imagelist li",aO).on("dblclick",".imagelist li",aQ).on("change","#post_type_select input",bn).on("click",".postlist li",bg).on("click",".load-more-posts",bm).on("click","a.btnsrc",bv).on("click",".imagepreview",aP).on("click","a.nav-tab",aH).on("change","select.check-for-posts",a2).on("keyup change","#rss_url",bn).on("keyup change","#post-search",a8).on("keyup change","#image-search",a8).on("click","#rss_url",function(){R(this).focus().select()}).on("click",".rss_change",az).on("click","#recent_feeds a",bf).on("mouseenter","#wp-mailster-editor-wrap, .imagelist, .postlist, .CodeMirror",aZ).on("mouseleave","#wp-mailster-editor-wrap, .imagelist, .postlist, .CodeMirror",bp);am(D.contents().find("img").eq(0),function(bz,bA,bB){var by=bB>=1.5;br.val(bB);bb.prop("checked",by);(by)?bj.addClass("high-dpi"):bj.removeClass("high-dpi")});aL.on("click","a",function(){R(this).parent().find("a").removeClass("nav-tab-active");R(this).parent().parent().find("ul.buttons").hide();var by=R(this).addClass("nav-tab-active").attr("href");R("#tab-"+by.substr(1)).show();return false});bu.on("paste change",function(bz){var by=R(this);setTimeout(function(){var bB=a7(by.val()),bA=new Image();if(bB){aT();bA.onload=function(){a9.attr("src",bB);aI.val(Math.round(bA.width/(bA.width/bA.height)));bl={width:bA.width,height:bA.height,asp:bA.width/bA.height};aT(false)};bA.onerror=function(){if(bz.type!="paste"){alert(x(mailsterL10n.invalid_image,'"'+bB+'"'))}};bA.src=bB}},1)});aM.on("change, keyup",function(){if(!aw.is(":checked")){aI.val(Math.round(aM.val()/bl.asp))}aN()});aI.on("change, keyup",function(){if(!aw.is(":checked")){aM.val(Math.round(aI.val()*bl.asp))}aN()});aw.on("change",function(){if(!aw.is(":checked")){aI.val(Math.round(aM.val()/bl.asp));aw.parent().removeClass("not-cropped")}else{aw.parent().addClass("not-cropped")}aN()});R("#dynamic_embed_options_post_type").on("change",function(){var by=R("#dynamic_embed_options_cats");by.find("select").prop("disabled",true);aT();S("get_post_term_dropdown",{posttype:R(this).val()},function(bz){aT(false);if(bz.success){by.html(bz.html);if(ax&&ax.terms){var bA=by.find(".dynamic_embed_options_taxonomy_wrap");R.each(ax.terms,function(bC,bB){if(!bB){return}var bD=bB.split(",");R.each(bD,function(bF,bH){var bE=bA.eq(bC).find("select").eq(bF),bG;if(!bE.length){bG=bA.eq(bC).find("select").last();bE=bG.clone();bE.insertAfter(bG);R("<span> "+mailsterL10n.or+" </span>").insertBefore(bE)}bE.val(bH)})})}}a2()},function(bz,bB,bA){aT(false)})});bj.on("keypress.mailster",function(by){if(by.keyCode==13&&by.target.nodeName.toLowerCase()!="textarea"){return false}}).on("keyup.mailster",function(by){switch(by.keyCode){case 27:aA();return false;break;case 13:if(aS.type!="multi"&&aS.type!="codeview"){aQ();return false}break}});bj.find(".current-tag").on("click","a",function(){return false});if(bj.draggable){bj.draggable({distance:20,axis:"y"})}if(o&&tinymce.get("mailster-editor")){if(tinymce.majorVersion>=4){tinymce.get("mailster-editor").on("keyup",function(){a4(this)});tinymce.get("mailster-editor").on("ExecCommand",function(){a4(this)})}else{tinymce.get("mailster-editor").onKeyUp.add(function(){a4(this)});tinymce.get("mailster-editor").onExecCommand.add(function(){a4(this)})}}}function bs(by){if(bj.draggable){if(by!==false){bj.draggable("enable")}else{bj.draggable("disable")}}}function aZ(){bs(false)}function bp(){bs(true)}function aH(bA,by){var bz;if(typeof bA=="string"){bz=aR.find('a[href="'+bA+'"]')}else{bz=R(this);bA=bz.attr("href")}bz.parent().find("a.nav-tab").removeClass("nav-tab-active");bz.addClass("nav-tab-active");aR.find(".tab").hide();aR.find(bA).show();if(bA=="#dynamic_embed_options"&&by!==false){R("#dynamic_embed_options_post_type").trigger("change")}if(bA=="#image_button"){be="image"}if(bA=="#text_button"){be="text"}aK=aR.find(bA).find(".postlist").eq(0);return false}function a6(){aT();var bB=br.val(),by=aS.element.width(),bA=Math.round(by/1.6),bz=R("<img>",{src:"https://dummy.newsletter-plugin.com/"+(by*bB)+"x"+(bA*bB)+".jpg",alt:aS.content,label:aS.content,width:by,height:bA,border:0,editable:aS.content});bz[0].onload=function(){bz.attr({width:by,height:bA}).removeAttr("style");bi()};if(aS.element.parent().is("a")){aS.element.unwrap()}if(!aS.element.parent().is("td")){aS.element.unwrap()}aS.element.replaceWith(bz);return false}function a0(){if(R(this).is(":checked")){br.val(2);bj.addClass("high-dpi")}else{br.val(1);bj.removeClass("high-dpi")}}function a2(){clearInterval(aV);aT();R("#dynamic_embed_options").find("h4.current-match").html("&hellip;");R("#dynamic_embed_options").find("div.current-tag").html("&hellip;");aV=setTimeout(function(){var bC=bj.find("#dynamic_embed_options_post_type").val(),bz=bj.find("#dynamic_embed_options_content").val(),bB=bj.find("#dynamic_embed_options_relative").val(),bA=bj.find(".dynamic_embed_options_taxonomy_wrap"),by=[];R.each(bA,function(bF){var bE=R(this).find("select"),bD=[];R.each(bE,function(){var bG=parseInt(R(this).val(),10);if(bG!=-1&&R.inArray(bG,bD)==-1&&!isNaN(bG)){bD.push(bG)}});bD=bD.join(",");if(bD){by[bF]=bD}});S("check_for_posts",{id:X,post_type:bC,relative:bB,extra:by,modulename:aS.name,expect:aS.elements.expects},function(bD){aT(false);if(bD.success){bo=bD.pattern;R("#dynamic_embed_options").find("h4.current-match").html(bD.title);R("#dynamic_embed_options").find("div.current-tag").text(bD.pattern.title+"\n\n"+bD.pattern[bz])}},function(bD,bF,bE){aT(false)})},500)}function a7(bC,by,bz,bD,bB){by=by||aM.val();bz=bz||aI.val()||Math.round(by/1.6);bD=typeof bD=="undefined"?aw.prop(":checked"):bD;bB=typeof bB=="undefined"?a1.prop(":checked"):bB;if(/^\{([a-z0-9-_,;:|]+)\}$/.test(bC)){var bA=br.val();bC=mailsterdata.ajaxurl+"?action=mailster_image_placeholder&tag="+bC.replace("{","").replace("}","")+"&w="+Math.abs(by)+"&h="+Math.abs(bz)+"&c="+(bD?1:0)+"&o="+(bB?1:0)+"&f="+bA}return bC}function a3(bz){if(-1!==bz.indexOf("?action=mailster_image_placeholder&tag=")){var by=bz.match(/&tag=([a-z0-9-_,;:|]+)&/);return"{"+by[1]+"}"}return false}function at(by){if((by.keyCode||by.which)!=27&&aS){aS.element.html(R(this).val())}}function aT(by){if(by===false){R("#editbar-ajax-loading").hide();bj.find(".buttons").find("button").prop("disabled",false)}else{R("#editbar-ajax-loading").css("display","inline");bj.find(".buttons").find("button").prop("disabled",true)}}function aQ(){if(aS.type=="img"){var bR=aS.element.is("img");if(bu.val()){bl={id:null,name:"",src:a7(bu.val()),width:bl.width,height:bl.height,asp:bl.width/bl.height}}if(bl){aT();var bN=br.val()||1,bF=aM.val(),bM=aI.val(),bQ=aw.is(":checked"),bJ=a1.is(":checked"),bG=bR?"src":"background";aS.element.attr({"data-id":bl.id}).data("id",bl.id).addClass("mailster-loading");if(bR){aS.element.attr({src:bl.src,alt:bl.name});if(!aS.is_percentage){aS.element.attr("width",Math.round(bF))}if(aS.element.attr("height")&&aS.element.attr("height")!="auto"){aS.element.attr("height",Math.round(bM))}if(bQ){aS.element.attr({"data-crop":true}).data("crop",true)}if(bJ){aS.element.attr({"data-original":true}).data("original",true)}}if(bl.src){aS.element.attr(bG,bl.src);aS.element[0].style.cssText=aS.element[0].style.cssText.replace(/url\("?(.+)"?\)/,"url("+bl.src+")")}S("create_image",{id:bl.id,original:bJ,src:bl.src,width:bF*bN,height:bM*bN,crop:bQ},function(bT){aT(false);if(bT.success){a9.attr("src",bT.image.url);bT.image.width=(bT.image.width||bl.width)/bN;bT.image.height=bT.image.width/(bl.asp);bT.image.asp=bl.asp;bl=bT.image;bl.name=ay.val();if(bR){aS.element.one("load error",function(bX){if("error"==bX.type){alert(x(mailsterL10n.invalid_image,bT.image.url))}aS.element.removeClass("mailster-loading");a("save")});aS.element.attr({alt:bl.name});if(!aS.is_percentage){aS.element.attr("width",Math.round(aM.val()))}if(aS.element.attr("height")&&aS.element.attr("height")!="auto"){aS.element.attr("height",Math.round(aI.val()))}if(bQ){aS.element.attr({"data-crop":true}).data("crop",true)}if(bJ){aS.element.attr({"data-original":true}).data("original",true)}}else{aS.element.removeClass("mailster-loading");var bU=aS.element.html(),bW=bU.match(/<modules/),bV;if(bx.val()){if(bW){if(bW=bU.match(new RegExp("<v:background(.*)</v:background>","s"))){aS.element.html(an(bU,bW[0],an(bW[0],bx.val(),bl.url)))}}else{aS.element.html(an(bU,bx.val(),bl.url));aS.element.find("single, multi").removeAttr("id")}}}aS.element.removeAttr(bG).attr(bG,bl.url)}else{aS.element.removeClass("mailster-loading")}ay.val("");bi()},function(bT,bV,bU){aT(false)})}else{aS.element.attr({alt:ay.val()});bi()}if(aS.element.parent().is("a")){aS.element.unwrap()}var bB=aG.val();if(bB){aS.element.wrap('<a href="'+bB+'"></a>')}return false}else{if(aS.type=="btn"){var bB=bt.val();if(!bB&&!confirm(mailsterL10n.remove_btn)){return false}var bA=aR.find("a.active").find("img").attr("src");if(typeof bA=="undefined"){be="text";if(!aW.val()){aW.val(mailsterL10n.read_more)}}if("image"==be){var bN=br.val();var bS=new Image();bS.onload=function(){if(!aS.element.find("img").length){var bU=aS.element.closest(".textbutton");var bT=R('<a href="" editable label="'+aS.name+'"><img></a>');(bU.length)?bU.replaceWith(bT):aS.element.replaceWith(bT);aS.element=bT}aS.element.find("img").attr({src:bA,width:Math.round((bS.width||aS.element.width())/bN),height:Math.round((bS.height||aS.element.height())/bN),alt:aF.val()});(bB)?aS.element.attr("href",bB):aS.element.remove();bi()};bS.src=bA}else{var bD=aS.element.closest(".textbutton"),bC=aW.val();if(!bD.length){aS.element.replaceWith('<table class="textbutton" align="left" role="presentation"><tr><td align="center" width="auto"><a href="'+bB+'" editable label="'+bC+'">'+bC+"</a></td></tr></table>")}else{if(aS.element[0]==bD[0]){aS.element=bD.find("a")}aS.element.text(bC)}if(bB){aS.element.attr("href",bB)}else{aS.element.remove();bD.remove()}bi()}return false}else{if(aS.type=="auto"){var bP=R("#embedoption-bar").find(".nav-tab-active").data("type");if("dynamic"==bP){var bH=bj.find("#dynamic_embed_options_content").val();bo.content=bo[bH];aS.element.attr("data-tag",bo.tag).data("tag",bo.tag)}else{if("rss"==bP){var bH=R(".embed_options_content_rss:checked").val();aS.element.removeAttr("data-tag").removeData("tag").attr("data-rss",R("#rss_url").val())}else{var bH=R(".embed_options_content:checked").val();aS.element.removeAttr("data-tag").removeData("tag")}}if(bo){if(bo.title){aS.elements.single.each(function(bT,bV){var bW=R(this),bU=bW.attr("expect")||"title";if(!R.isArray(bo[bU])){bo[bU]=[bo[bU]]}bW.html(bo[bU].shift())})}if(bo.link){if(aS.elements.buttons.length){aS.elements.buttons.last().attr("href",bo.link);aS.elements.buttons.not(":last").remove()}else{aS.elements.multi.last().after('<buttons><table class="textbutton" align="left" role="presentation"><tr><td align="center" width="auto"><a href="'+bo.link+'" title="'+mailsterL10n.read_more+'" editable label="'+mailsterL10n.read_more+'">'+mailsterL10n.read_more+"</a></td></tr></table></buttons>")}}else{if(aS.elements.buttons.parent().length&&aS.elements.buttons.parent()[0].nodeName=="TD"){aS.elements.buttons.closest(".textbutton").remove()}else{if(aS.elements.buttons.length){if(aS.elements.buttons.last().find("img").length){aS.elements.buttons.remove()}}}}if(aS.elements.multi.length){var by=aS.elements.multi.length,bI=bo[bH]?bo[bH]:"",bK=[],bO,bz;if(!R.isArray(bI)){bO=bI.length,bz=("static"==bP)?Math.ceil(bO/by):bO;for(var bL=0;bL<by;bL++){bK.push(bI.substring(bL*bz,bL*bz+bz))}}else{bK=bI}aS.elements.multi.each(function(bT,bU){R(this).html(bK[bT]?bK[bT]:"")})}if(bo.image&&aS.elements.images.length){if(!R.isArray(bo.image)){bo.image=[bo.image]}aT();aS.elements.images.each(function(bW,bZ){if(!bo.image[bW]){return}var bU=R(this);var bY=br.val();if("static"==bP){S("create_image",{id:bo.image[bW].id,original:a1.is(":checked"),width:bU.width()*bY,height:bU.height()*bY,crop:bU.data("crop")},function(b2){if(b2.success){aT(false);if(a1.is(":checked")){bU.attr({"data-original":true}).data("original",true)}if("img"==bU.prop("tagName").toLowerCase()){bU.attr({"data-id":bo.image[bW].id,src:b2.image.url,width:Math.round(b2.image.width/bY),alt:bo.alt||bo.title[bW]}).data("id",bo.image[bW].id);if(bU.attr("height")&&bU.attr("height")!="auto"){bU.attr("height",Math.round(b2.image.height/bY))}if(bU.parent().is("a")){bU.unwrap()}if(bo.link){bU.wrap("<a>");bU.parent().attr("href",bo.link)}}else{var b3=bU.attr("background");bU.attr({"data-id":bo.image[bW].id,background:b2.image.url}).data("id",bo.image[bW].id).css("background-image","");aS.element.html(an(aS.element.html(),b3,b2.image.url))}}bi()},function(b2,b4,b3){aT(false)});return false}else{if("dynamic"==bP||"rss"==bP){var bT=bU.width(),bX=bU.data("crop"),b1=a1.is(":checked"),b0=bX?bU.height():null;if("img"==bU.prop("tagName").toLowerCase()){bU.removeAttr("data-id").attr({src:a7(bo.image[bW],bT,b0,bX,b1),width:bT,alt:bo.alt||bo.title[bW]}).removeData("id");if(bU.attr("height")){bU.attr("height",b0||Math.round(bT/1.6))}}else{var bV=bU.attr("background");bU.removeAttr("data-id").attr({background:a7(bo.image[bW],bT)}).removeData("id").css("background-image","");aS.element.html(an(aS.element.html(),bV,a7(bo.image[bW],bT,b0,bX,b1)))}}}})}D.contents().find("html").find("img").each(function(){this.onload=function(){a("refresh")}})}}else{if(aS.type=="multi"){if(o&&tinymce.get("mailster-editor")&&!tinymce.get("mailster-editor").isHidden()){var bK=tinymce.get("mailster-editor").getContent();bK=bK.replace('href="http://{','href="{');aS.element.html(bK)}}else{if(aS.type=="single"){if(aS.conditions){aS.aa="<if";R.each(R(".conditinal-area"),function(){aS.aa=""})}if(aS.element.parent().is("a")){aS.element.unwrap()}var bB=bc.val();if(bB){aS.element.wrap('<a href="'+bB+'"></a>')}}else{if(aS.type=="codeview"){var bE=P.getValue();aS.element.html(bE);aS.modulebuttons.prependTo(aS.element)}}}}}}bi();return false}function aY(){if(aS.element.parent().is("a")){aS.element.unwrap()}if("btn"==aS.type){var by=aS.element.closest(".textbutton");if(!by.length){by=aS.element}if(by.parent().children().length>2){by.remove()}else{by.remove()}}else{if("img"==aS.type&&"img"!=aS.tag){aS.element.attr("background","")}else{aS.element.remove()}}bi();return false}function aA(){switch(aS.type){case"img":case"btn":break;default:aS.element.html(aS.content)}bi();return false}function bv(){var bA=R(this),by=bA.data("link");aR.find(".btnsrc").removeClass("active");bA.addClass("active");aF.val(bA.attr("title"));if(by){var bz;bt.val(by);if((bz=(by+"").indexOf("USERNAME",0))!=-1){bt.focus();p(bt[0],bz,bz+8)}}return false}function aP(){R(this).toggleClass("zoom")}function aO(bA,bz){var bD=bz||R(this),bC=bD.data("id"),by=bD.data("name"),bB=bD.data("src");if(!bC){return}bl={id:bC,name:by,src:bB};aT();aR.find("li.selected").removeClass("selected");bD.addClass("selected");if(aS.element.data("id")==bC){ay.val(aS.element.attr("alt"))}else{if(aS.element.attr("alt")!=by){ay.val(by)}}bu.val("");a9.attr("src","").on("load",function(){a9.off("load");aS.width=a9.width();aS.height=a9.height();aS.asp=bD.data("asp")||(aS.width/aS.height);bl.asp=aS.asp;aT(false);if(!aw.is(":checked")){aI.val(Math.round(aM.val()/aS.asp))}aN()}).attr("src",bB);return bl}function aN(){var by=Math.round(0.5*(aS.height-(aS.width*(aI.val()/aM.val())))),bz=br.val();a9.css({clip:"rect("+(by)+"px,"+(aS.width*bz)+"px,"+(aS.height*bz-by)+"px,0px)","margin-top":(-1*by)+"px"})}function bg(){var bC=R(this),bB=bC.data("id"),by=bC.data("name"),bz=bC.data("link"),bA=bC.data("thumbid");if(aS.type=="btn"){bt.val(bz);aF.val(by);aR.find("li.selected").removeClass("selected");bC.addClass("selected")}else{if(aS.type=="single"){bc.val(bz);aR.find("li.selected").removeClass("selected");bC.addClass("selected")}else{aT();S("get_post",{id:bB,expect:aS.elements.expects},function(bD){aT(false);aR.find("li.selected").removeClass("selected");bC.addClass("selected");if(bD.success){bo=bD.pattern;aR.find(".editbarinfo").html(mailsterL10n.curr_selected+": <span>"+bo.title+"</span>")}},function(bD,bF,bE){aT(false);aR.find("li.selected").removeClass("selected")})}}return false}function aX(bT){aS=bT;var bA=bT.element,bz=bA.closest("module"),bL=(bC!="img")?bT.offset.top:0,bU=bT.name||"",bC=bT.type,bN=R.trim(bA.html()),bO=bA.find("if"),bG,bS,bJ,bE,bH=1;aR=bj.find("div.type."+bC);bj.addClass("current-"+bC);aS.width=bA.width();aS.height=bA.height();aS.asp=aS.width/aS.height;aS.crop=bA.data("crop")?bA.data("crop"):false;aS.tag=bA.prop("tagName").toLowerCase();aS.is_percentage=bA.attr("width")&&bA.attr("width").indexOf("%")!==-1;aS.content=bN;ax=aS.element.data("tag");a("selectModule",bz);if(bO.length){bG={"if":null,elseif:[],"else":null,total:0};bG=[];bj.addClass("has-conditions");bS=aR.find(".conditinal-area");bJ=bj.find(".conditions").eq(0);bJ.clone().prependTo(bS);R.each(bO.find("elseif"),function(){var bW=R(this),bV=bW.html();bG.push({el:bW,html:bV,field:bW.attr("field"),operator:bW.attr("operator"),value:bW.attr("value")});bW.detach();bS.clone().val(bV).insertAfter(bS)});R.each(bO.find("else"),function(){var bW=R(this),bV=bW.html();bG.push({el:bW,html:bV});bW.detach();bS.clone().val(bV).insertAfter(bS)});bG.unshift({el:bO,html:bO.html(),field:bO.attr("field"),operator:bO.attr("operator"),value:bO.attr("value")})}else{bj.removeClass("has-conditions")}aS.conditions=bG;if(bC=="img"){a1.prop("checked",aS.original);aw.prop("checked",aS.crop).parent()[aS.crop?"addClass":"removeClass"]("not-cropped");br.val(1);am(bA,function(bV,bW,bX){var bW=bX>=1.5;br.val(bX);bb.prop("checked",bW);(bW)?bj.addClass("high-dpi"):bj.removeClass("high-dpi");bH=bX})}else{if(bC=="btn"){if(bA.find("img").length){R("#button-type-bar").find("a").eq(1).trigger("click");var bD=bA.find("img").attr("src");if(aL.length){var by=bj.find("img[src='"+bD+"']");if(by.length){bj.find("ul.buttons").hide();var bR=by.parent().parent().parent();bj.find('a[href="#'+bR.attr("id").substr(4)+'"]').trigger("click")}else{R.each(bj.find(".button-nav"),function(){R(this).find(".nav-tab").eq(0).trigger("click")})}}aW.val(bA.find("img").attr("alt"));am(bA.find("img"),function(bV,bW,bX){var bW=bX>=1.5;br.val(bX);bb.prop("checked",bW);(bW)?bj.addClass("high-dpi"):bj.removeClass("high-dpi");bH=bX})}else{R("#button-type-bar").find("a").eq(0).trigger("click");aW.val(R.trim(bA.text())).focus().select();bt.val(aS.element.attr("href"));bj.find("ul.buttons").hide()}}else{if(bC=="auto"){aH("#"+(ax?"dynamic":"static")+"_embed_options",true);if(ax){var bM=ax.substr(1,ax.length-2).split(":"),bB=bM[1].split(";"),bQ=parseInt(bB.shift(),10),bF=bB.length?bB:null;ax={post_type:bM[0],relative:bQ,terms:bF};R("#dynamic_embed_options_post_type").val(ax.post_type).trigger("change");R("#dynamic_embed_options_relative").val(ax.relative).trigger("change")}else{}}else{if(bC=="codeview"){var bK=aR.find("textarea"),bP=bA.clone();aS.modulebuttons=bP.find("modulebuttons");bP.find("modulebuttons, button").remove();bP.find("single, multi").removeAttr("contenteditable spellcheck id dir style class");var bI=R.trim(bP.html().replace(/\u200c/g,"&zwnj;").replace(/\u200d/g,"&zwj;"));bK.show().html(bI)}}}}bE=C.offset().top+(aS.offset.top-(af.height()/2)+(aS.height/2));bE=Math.max(C.offset().top-200,bE);d(bE,function(){bj.find("h4.editbar-title").html(bU);bj.find("div.type").hide();bj.find("div."+bC).show();var bZ=j.scrollTop()+(af.height()/2)-C.offset().top-(bj.height()/2);bj.css({top:bZ});aT();if(bC=="single"){if(bG){R.each(bG,function(b4,b5){var b3=aR.find(".conditinal-area").eq(b4);b3.find("select.condition-fields").val(b5.field);b3.find("select.condition-operators").val(b5.operator);b3.find("input.condition-value").val(b5.value);b3.find("input.input").val(b5.html)})}else{var b2=bN.replace(/&amp;/g,"&");bc.val("");if(aS.element.parent().is("a")){var bW=aS.element.parent().attr("href");bc.val(bW!="#"?bW:"");aU()}else{if(aS.element.find("a").length){var bY=aS.element.find("a");if(b2==bY.text()){var bW=bY.attr("href");b2=bY.text();bc.val(bW!="#"?bW:"")}}}aR.find("input").eq(0).val(R.trim(b2))}}else{if(bC=="img"){var bV=parseInt(bA[0].style.maxWidth,10)||bA.parent().width()||bA.width()||null;var b1=parseInt(bA[0].style.maxHeight,10)||bA.parent().height()||bA.height()||null;var b0=bA.attr("src")||bA.attr("background");var bX=a3(b0)||"";if(bA.parent().is("a")){aG.val(bA.parent().attr("href").replace("%7B","{").replace("%7D","}"))}else{aG.val("")}ay.val(bA.attr("alt"));bu.val(bX);bx.val(b0);bA.data("id",bA.attr("data-id"));R(".imageurl-popup").toggle(!!bX);a9.removeAttr("src").attr("src",b0);bk="attachment";aK=aR.find(".imagelist");bl={id:bA.data("id"),src:b0,width:bA.width()*bH,height:bA.height()*bH};bl.asp=bl.width/bl.height;bn();aN()}else{if(bC=="btn"){aF.val(bA.find("img").attr("alt"));if(bA.attr("href")){bt.val(bA.attr("href").replace("%7B","{").replace("%7D","}"))}bk="link";aK=aR.find(".postlist").eq(0);bn();R.each(aR.find(".buttons img"),function(){var b3=R(this);b3.css("background-color",bA.css("background-color"));(b3.attr("src")==bD)?b3.parent().addClass("active"):b3.parent().removeClass("active")})}else{if(bC=="auto"){bk="post";aK=aR.find(".postlist").eq(0);bn();aS.elements={single:aS.element.find("single"),multi:aS.element.find("multi"),buttons:aS.element.find("a[editable]"),images:aS.element.find("img[editable], td[background], th[background]"),expects:aS.element.find("[expect]").map(function(){return R(this).attr("expect")}).toArray()}}else{if(bC=="codeview"){if(P){P.clearHistory();P.setValue("");aR.find(".CodeMirror").remove()}}}}}}bj.show(0,function(){if(bC=="single"){bj.find("input").focus().select()}else{if(bC=="img"){aM.val(aS.width);aI.val(aS.height);aw.prop("checked",aS.crop)}else{if(bC=="btn"){aM.val(bV);aI.val(b1)}else{if(bC=="multi"){R("#mailster-editor").val(bN);if(o&&tinymce.get("mailster-editor")){tinymce.get("mailster-editor").setContent(bN);tinymce.execCommand("mceFocus",false,"mailster-editor")}}else{if(bC=="codeview"){P=CodeMirror.fromTextArea(bK.get(0),E)}}}}}});aT(false)},100)}function bn(by,bB){var bA=R("#post_type_select").find("input:checked").serialize(),bz={type:bk,posttypes:bA,search:au,offset:0};if(R(this).is("#rss_url")){bz.type="_rss";bz.url=R.trim(R("#rss_url").val());if(bz.url==aD){return false}aD=bz.url;if(!bz.url){R("#rss_more").slideUp(200);return false}R(".rss_info").html("")}if(bk=="attachment"){bz.id=bl.id}aK.empty();aT();S("get_post_list",bz,function(bC){aT(false);if(bC.success){aB=bC.itemcount;bd(bC.html,true);if(bC.rssinfo){R("#rss_more").slideDown(200);R("#rss_input").slideUp(200);R(".rss_info").html("<h4>"+bC.rssinfo.title+" &ndash; "+bC.rssinfo.description+'</h4><p class="tiny">'+bC.rssinfo.copyright+"</p>")}bB&&bB()}},function(bC,bE,bD){aT(false)})}function bm(){var bA=R(this),bB=bA.data("offset"),by=bA.data("type");aT();var bz=R("#post_type_select").find("input:checked").serialize();S("get_post_list",{type:by,posttypes:bz,search:au,offset:bB,url:R.trim(R("#rss_url").val()),itemcount:aB},function(bC){aT(false);if(bC.success){aB=bC.itemcount;bA.parent().remove();bd(bC.html,false)}},function(bC,bE,bD){aT(false)});return false}function a8(){var by=R(this);clearTimeout(aE);aE=setTimeout(function(){var bz=by.val();if(bz==au){return}au=bz;bn()},300)}function aU(){R("#single-link").slideDown(200);bc.focus().select();bk="link";aK=aR.find(".postlist").eq(0);bn();return false}function bd(bz,by,bA){if(!bA){bA=aK}if(by){bA.empty()}if(!bA.html()){bA.html("<ul></ul>")}bA.find("ul").append(bz)}function bf(){R("#rss_url").val(R(this).attr("href")).trigger("change");return false}function az(){R("#rss_url").val("");R("#rss_more").slideUp(200);R("#rss_input").slideDown(200);return false}function aJ(){R(".imageurl-popup").toggle();if(!bu.val()&&bl.src.indexOf(location.origin)==-1&&bl.src.indexOf("dummy.newsletter-plugin.com")==-1){bu.val(bl.src)}bu.focus().select();return false}function a5(){if(!wp.media.frames.mailster_editbar){wp.media.frames.mailster_editbar=wp.media({title:mailsterL10n.select_image,library:{type:"image"},multiple:false});wp.media.frames.mailster_editbar.on("select",function(){var bz=wp.media.frames.mailster_editbar.state().get("selection").first().toJSON(),by=R("img").data({id:bz.id,name:bz.name,src:bz.url});bn(null,function(){aO(null,by)})})}wp.media.frames.mailster_editbar.open()}function a4(by){clearTimeout(aj);aj=setTimeout(function(){if(!by){return}var bz=R.trim(by.save());aS.element.html(bz)},100)}function bi(){bj.removeClass("current-"+aS.type).hide();aT(false);R("#single-link").hide();a("save");a("refresh");return false}bq();return{open:function(by){aX(by)},close:function(){bi()}}};var ap=function(){var ay=R("#mailster_template"),aK=R("#module-selector"),aA=R("#module-search"),aM=aK.find("li"),aJ=R("a.toggle-modules"),aF=D.contents().find("modules"),aD=D.contents().find("body"),aN=aF.find("module"),aG,av={},aI=!!parseInt(window.getUserSetting("mailstershowmodules",1),10);function ax(){var aQ=aK.data("current");at(R(this).data("id"),((aQ&&aQ.is("module"))?aQ:false),true,true);return false}function aB(){var aQ=R(this).parent().parent().parent(),aR=aQ.offset();aQ.insertBefore(aQ.prev("module"));q(aQ.offset().top-aR.top,true);a("refresh");a("save");return false}function aC(){var aQ=R(this).parent().parent().parent(),aR=aQ.offset();aQ.insertAfter(aQ.next("module"));q(aQ.offset().top-aR.top,true);a("refresh");a("save");return false}function au(){var aQ=R(this).parent().parent().parent(),aR=aQ.clone().removeAttr("selected").hide();at(aR,aQ,false,true);return false}function az(){var aQ=R(this).parent().parent().parent();M.open({element:aQ,name:aQ.attr("label"),type:"auto",offset:aQ.offset()});return false}function aE(){var aS=R(this),aR=aS.val(),aQ=aS.parent().parent();if(!aR){aR=aS.attr("placeholder");aS.val(aR)}aQ.attr("label",aR)}function aP(){var aQ=R(this).parent().parent().parent();aQ.fadeTo(100,0,function(){aQ.slideUp(100,function(){aQ.remove();aN=D.contents().find("module");if(!aN.length){aF.html("")}a("refresh");a("save")})});return false}function at(aR,aS,aT,aQ){var aV;if(av[aR]){aV=av[aR].el.clone()}else{if(aR instanceof jQuery){aV=R(aR);aV.find("single, multi, buttons").removeAttr("contenteditable spellcheck id dir style class")}else{return false}}if(!aS&&!aF.length){return false}if(aS){(aT?aV.hide().insertBefore(aS):aV.hide().insertAfter(aS))}else{if("footer"==aN.last().attr("type")){aV.hide().insertBefore(aN.last())}else{aV.hide().appendTo(aF)}}aN=aF.find("module");aV.slideDown(100,function(){aV.css("display","block");a("resize");a("refresh");a("save")});if(aQ){var aU=aV.offset().top+C.offset().top-(af.height()/2)-aV.outerHeight();aU=Math.max(C.offset().top,aU);d(aU)}}function ar(){var aQ=R(this).parent().parent().parent();M.open({element:aQ,name:aQ.attr("label"),type:"codeview",offset:aQ.offset()});return false}function aO(){Z.toggleClass("show-modules");aI=!aI;window.setUserSetting("mailstershowmodules",aI?1:0);setTimeout(function(){a("resize")},200)}function aH(){aM.hide();aK.find("li:contains('"+R(this).val()+"')").show()}function aL(){C.on("click","a.toggle-modules",aO).on("click","a.addmodule",ax);aA.on("keyup",aH).on("focus",function(){aA.select()});R("#module-search-remove").on("click",function(){aA.val("").trigger("keyup").focus();return false});aw()}function aw(){aN=D.contents().find("module");if(!aN.length){aF.html("")}aG=R(ac.val()).add(aN);if(!aG.length){aK.remove();return}aF=D.contents().find("modules");aF.on("click","a.up",aB).on("click","a.down",aC).on("click","a.auto",az).on("click","a.duplicate",au).on("click","a.remove",aP).on("click","a.codeview",ar).on("change","input.modulelabel",aE);var aT="",aX="",aR=0,aW=0;av=[];R.each(aG,function(a0){var a2=R(this);if(a2.is("module")){var aZ=a2.attr("label")||x(mailsterL10n.module,"#"+(++aW)),a1=mailsterdata.codeview?'<a class="mailster-btn codeview" title="'+mailsterL10n.codeview+'"></a>':"",a3=(a2.is("[auto]")?'<a class="mailster-btn auto" title="'+mailsterL10n.auto+'"></a>':"");R("<modulebuttons><span>"+a3+'<a class="mailster-btn duplicate" title="'+mailsterL10n.duplicate_module+'"></a><a class="mailster-btn up" title="'+mailsterL10n.move_module_up+'"></a><a class="mailster-btn down" title="'+mailsterL10n.move_module_down+'"></a>'+a1+'<a class="mailster-btn remove" title="'+mailsterL10n.remove_module+'"></a></span><input class="modulelabel" type="text" value="'+aZ+'" placeholder="'+aZ+'" title="'+mailsterL10n.module_label+'" tabindex="-1"></modulebuttons>').prependTo(a2);if(!a2.parent().length){av.push({name:aZ,el:a2})}}});var aS,aY,aV=R("<dropzone></dropzone>"),aQ=aV.clone(),aU=aV.add(aQ);if(!R._data(aK[0],"events")){aK.on("dragstart.mailster","li",function(aZ){window.mailster_is_modulde_dragging=true;aZ.originalEvent.dataTransfer.setData("Text",this.id);aD.addClass("drag-active");aY=R(aZ.target).data("id");aF.on("dragenter.mailster",function(a0){var a1=R(a0.target).closest("module");if(!a1.length||aS&&aS[0]===a1[0]){return}aS=a1;aQ.appendTo(aS);aV.prependTo(aS);setTimeout(function(){aQ.addClass("visible");aV.addClass("visible");aN.removeClass("drag-up drag-down");a1.prevAll("module").addClass("drag-up");a1.nextAll("module").addClass("drag-down")},1)}).on("dragover.mailster",function(a0){a0.preventDefault()}).on("drop.mailster",function(a0){at(aY,aN.length?(aS&&aS[0]===aF?false:aS):false,aV[0]===a0.target,false,true);aN=D.contents().find("module");a0.preventDefault()});aU.on("dragenter.mailster",function(a0){R(this).addClass("drag-over")}).on("dragleave.mailster",function(a0){R(this).removeClass("drag-over")})}).on("dragend.mailster","li",function(aZ){aS=null;aD.removeClass("drag-active");aU.removeClass("visible drag-over").remove();aN.removeClass("drag-up drag-down");aF.off("dragenter.mailster").off("dragover.mailster").off("drop.mailster");aU.off("dragenter.mailster").off("dragleave.mailster");window.mailster_is_modulde_dragging=false})}}aL();return{refresh:function(){aw()}}};function d(au,at,ar){au=Math.round(au);if(isNaN(ar)){ar=200}if(!k&&(ag.scrollTop()==au||document.scrollingElement.scrollTop==au)){at&&at();return}ag.stop().animate({scrollTop:au},ar,at&&function(){at()})}function q(at,ar){at=Math.round(at);if(ar){window.scrollBy(0,at)}else{window.scrollTo(0,at)}}R(window).on("Mailster:refresh",function(){clearTimeout(F);F=setTimeout(function(){a("resize");if(!f){w()}else{e()}},10)}).on("Mailster:resize",function(){var at=0,ar=0;if(!I){return false}setTimeout(function(){if(!D[0].contentWindow.document.body){return}var au=D.contents().height()||D[0].contentWindow.document.body.offsetHeight||D.contents().find("html")[0].innerHeight||D.contents().find("html").height();D.attr("height",Math.max(500,au+(ar||0)))},at?at:500)}).on("Mailster:save",function(){if(!f&&I){var au=B();var at=J.length,ar=J[at-1];if(ar!=au){Y.val(au);ab.prop("readonly",!au.match("{preheader}"));J=J.splice(0,ao+1);J.push(au);if(at>=mailsterL10n.undosteps){J.shift()}ao=J.length-1;if(ao){y.find("a.undo").removeClass("disabled")}y.find("a.redo").addClass("disabled");if(wp&&wp.autosave){wp.autosave.local.save()}}}}).on("Mailster:disable",function(){al=true;R(".button").prop("disabled",true);R("input:visible").prop("disabled",true)}).on("Mailster:enable",function(){R(".button").prop("disabled",false);R("input:visible, input.wp-color-picker").prop("disabled",false);al=false}).on("Mailster:selectModule",function(at){if(!at.detail){return}var ar=at.detail[0]}).on("Mailster:updateCount",function(){clearTimeout(t);t=setTimeout(function(){var aB=[],aA=[],aw=R("#list-checkboxes").find("input, select"),ax=R("#list-checkboxes").find("input.list"),at=R("#list_extra"),av={},az=R(".mailster-total"),ay=R("#mailster_conditions_render"),ar=R(".mailster-conditions-wrap > .mailster-condition-group"),au=0;R.each(ax,function(){var aC=R(this).val();if(R(this).is(":checked")){aB.push(aC)}});av.id=X;av.lists=aB;av.ignore_lists=R("#ignore_lists").is(":checked");R.each(ar,function(){var aC=R(this).find(".mailster-condition");R.each(aC,function(){var aG=R(this),aE,aF=aG.find(".condition-field").val(),aD=aG.find(".mailster-conditions-operator-field.active").find(".condition-operator").val();if(!aD||!aF){return}aE=aG.find(".mailster-conditions-value-field.active").find(".condition-value").map(function(){return R(this).val()}).toArray();if(aE.length==1){aE=aE[0]}if(!aA[au]){aA[au]=[]}aA[au].push({field:aF,operator:aD,value:aE})});au++});av.operator=R("select.mailster-list-operator").val();av.conditions=aA;az.addClass("loading");a("disable");S("get_totals",av,function(aC){a("enable");az.removeClass("loading").html(aC.totalformatted);ay.html(aC.conditions)},function(aC,aE,aD){a("enable");az.removeClass("loading").html("?")})},10)}).on("Mailster:xxx",function(){});function a(){var ar=arguments[0];var at=arguments[1]||null;var au;if(k){au=document.createEvent("CustomEvent");au.initCustomEvent("Mailster:"+ar,false,false,{detail:at})}else{au=new CustomEvent("Mailster:"+ar,{detail:at})}window.dispatchEvent(au);D[0].contentWindow.window.dispatchEvent(au)}function w(){C.find(".content.mailster-btn").remove();var ar=D.contents().find("html"),at=null;if(!ar){return}setTimeout(function(){if(!R._data(ar[0],"events")){ar.off(".mailster").on("click.mailster","img[editable]",function(aw){aw.stopPropagation();var az=R(this),aA=az.offset(),ay=aA.top+61,ax=aA.left,au=az.attr("label"),av="img";M.open({offset:aA,type:av,name:au,element:az})}).on("click.mailster","module td[background],module th[background]",function(au){au.stopPropagation();at=true}).on("click.mailster","td[background], th[background]",function(aw){aw.stopPropagation();if(!at&&aw.target!=this){return}at=null;var az=R(this),aA=az.offset(),ay=aA.top+61,ax=aA.left,au=az.attr("label"),av="img";M.open({offset:aA,type:av,name:au,element:az})}).on("click.mailster","a[editable]",function(aw){aw.stopPropagation();aw.preventDefault();var az=R(this),aA=az.offset(),ay=aA.top+40,ax=aA.left,au=az.attr("label"),av="btn";M.open({offset:aA,type:av,name:au,element:az})})}if(!mailsterdata.inline){ar.on("click.mailster","multi, single",function(aw){aw.stopPropagation();var az=R(this),aA=az.offset(),ay=aA.top+40,ax=aA.left,au=az.attr("label"),av=az.prop("tagName").toLowerCase();M.open({offset:aA,type:av,name:au,element:az})})}},500)}function e(ar){C.find(".clickbadge").remove();var ar=ar||R("#mailster_click_stats").data("stats"),at=parseInt(ar.total,10);if(!at){return}R.each(ar.clicks,function(av,au){R.each(au,function(ay,aC){var aB=D.contents().find('a[href="'+av.replace("&amp;","&")+'"]').eq(ay);if(aB.length){aB.css({display:"inline-block"});var ax=aB.offset(),aA=ax.top,aw=ax.left+5,aE=(aC.clicks/at)*100,aD=(aE<1?"&lsaquo;1":Math.round(aE))+"%",az=R('<a class="clickbadge '+(aE<40?"clickbadge-outside":"")+'" data-p="'+aE+'" data-link="'+av+'" data-clicks="'+aC.clicks+'" data-total="'+aC.total+'"><span style="width:'+(Math.max(0,aE-2))+'%">'+(aE<40?"&nbsp;":aD)+"</span>"+(aE<40?" "+aD:"")+"</a>").css({top:aA,left:aw}).appendTo(C)}})})}function Q(ax,aw,au){if(!ax){ax=aw}if(!aw){return false}if(ax==aw){return false}var at=i(),av=new RegExp(ax,"gi"),ar=ac.val();if(au){au.data("value",aw)}ac.val(ar.replace(av,aw));R("#mailster-color-"+ax.substr(1).toLowerCase()).attr("id","mailster-color-"+aw.substr(1).toLowerCase());U(at.replace(av,aw),3000)}function an(au,ar,at){if(ar===at){return au}do{au=au.replace(ar,at)}while(ar&&au.indexOf(ar)!==-1);return au}function L(at){var au=i(),av=/\/img\/version(\d+)\//g,aw="/img/"+at+"/";html=au.replace(av,aw);var ar=ac.val();ac.val(ar.replace(av,aw));U(html);return}function B(){var ar=D[0].contentWindow.document.body,ax,av,aw,at,au="";if(typeof ar=="null"||!ar){return""}ax=R("<div>"+ar.innerHTML+"</div>");ax.find(".mce-tinymce, .mce-widget, .mce-toolbar-grp, .mce-container, .screen-reader-text, .ui-helper-hidden-accessible, .wplink-autocomplete, modulebuttons, mailster, #mailster-editorimage-upload-button, button").remove();ax.find("#droplr-chrome-extension-is-installed").remove();ax.find("single, multi, module, modules, buttons").removeAttr("contenteditable spellcheck id dir style class selected");av=R.trim(ax.html().replace(/\u200c/g,"&zwnj;").replace(/\u200d/g,"&zwj;"));aw=ar.attributes||[];at=aw.length;if(at){while(at--){au=" "+aw[at].name+'="'+R.trim(aw[at].value)+'"'+au}}au=R.trim(au.replace(/(webkit |wp\-editor|mceContentBody|position: relative;|cursor: auto;|modal-open| spellcheck="(true|false)")/g,"").replace(/(class="(\s*)"|style="(\s*)")/g,""));return u.val()+"\n<body"+(au?" "+au:"")+">\n"+av+"\n</body>\n</html>"}function i(){return Y.val()||B()}function n(ar){var at=ar.match(/([^]*)<body([^>]*)?>([^]*)<\/body>([^]*)/m);return{parts:at?at:["","","","<multi>"+ar+"</multi>"],content:at?at[3]:"<multi>"+ar+"</multi>",head:at?R.trim(at[1]):"",bodyattributes:at?R("<div"+(at[2]||"")+"></div>")[0].attributes:""}}function U(ay,aw,au){var at=n(ay);var av=at.bodyattributes.length,az=(g||l)?D[0].contentWindow.document:s,ax=R(az).find("head").find("link"),ar=az.getElementsByTagName("head")[0];u.val(at.head);ar.innerHTML=at.head.replace(/([^]*)<head([^>]*)?>([^]*)<\/head>([^]*)/m,"$3");R(ar).append(ax);az.body.innerHTML=at.content;if(av){while(av--){az.body.setAttribute(at.bodyattributes[av].name,at.bodyattributes[av].value)}}if(aw!==false){clearTimeout(aj);aj=setTimeout(function(){K&&K.refresh&&K.refresh()},aw||100)}if(typeof au=="undefined"||au===true){a("save")}}function T(){return W.val()+Y.val()+b.val()+O.val()+ab.val()}function S(av,au,aw,at,ar){if(R.isFunction(au)){if(R.isFunction(aw)){at=aw}aw=au;au={}}ar=ar?ar:"JSON";R.ajax({type:"POST",url:ajaxurl,data:R.extend({action:"mailster_"+av,_wpnonce:G},au),success:function(ay,az,ax){aw&&aw.call(this,ay,az,ax)},error:function(az,aC,aB){var ax=R.trim(az.responseText);if(aC=="error"&&!aB){return}if(console){console.error(ax)}if("JSON"==ar){var ay=ax.match(/{(.*)}$/);if(ay&&aw){try{ay=R.parseJSON(ay[0]);aw.call(this,ay)}catch(aA){if(console){console.error(aA)}}return}}at&&at.call(this,az,aC,aB);alert(aC+" "+az.status+": "+aB+"\n\n"+mailsterL10n.check_console)},dataType:ar})}function v(ar){return R.trim(ar).toLowerCase().replace(/ /g,"_").replace(/[^a-z0-9_-]*/g,"")}function ah(){var aG,aC,ay,at,av,az=new Date(),ar=R(".time"),au=R(".deliverytime").eq(0),aB=R("#mailster_data_active"),aF=parseInt(ar.data("timestamp"),10)*1000,aE=false,aw=aF-az.getTime()+(az.getTimezoneOffset()*60000);var ax=(aE)?1000:20000;function aD(){aG=new Date();az=aG.getTime();aG.setTime(az+aw);ay=aG.getHours();at=aG.getMinutes();if(!f&&aC&&at!=aC[1]&&!aB.is(":checked")){au.val(aA(ay)+":"+aA(at))}aC=[];aC.push(aG.getHours());aC.push(aG.getMinutes());if(aE){aC.push(aG.getSeconds())}av=aC.length;for(var aH=0;aH<av;aH++){aC[aH]=aA(aC[aH])}ar.html(aC.join('<span class="blink">:</span>'));setTimeout(function(){aD()},ax)}function aA(aH){if(aH<10){aH="0"+aH}return aH}aD()}function x(){var ar=Array.prototype.slice.call(arguments),aw=ar.shift(),av=ar.length,au;for(var at=0;at<av;at++){au=new RegExp("%("+(at+1)+"\\$)?(s|d|f)");aw=aw.replace(au,ar[at])}return aw}function am(at,av){at=at.eq(0);if(at.is("img")&&at.attr("src")){var au=new Image(),ar;au.onload=function(){ar=((au.width/at.width()).toFixed(1)||1);if(av){av.call(this,au.width,au.height,isFinite(ar)?parseFloat(ar):1)}};au.src=at.attr("src")}}function r(au,at,ar,av){return(av===false?"":"#")+((1<<24)+(au<<16)+(at<<8)+ar).toString(16).slice(1)}if(document.selection&&document.selection.createRange){p=function(at,av,au){at.focus();at.select();var ar=document.selection.createRange();ar.collapse(true);ar.moveEnd("character",au);ar.moveStart("character",av);ar.select();return true}}else{p=function(ar,au,at){ar.selectionStart=au;ar.selectionEnd=at;return true}}if(window.getSelection){A=function(at){var av="";if(document.activeElement&&(document.activeElement.tagName.toLowerCase()=="textarea"||document.activeElement.tagName.toLowerCase()=="input")){var au=document.activeElement.value;av=au.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd)}else{var ar=window.getSelection();av=ar.toString()}return av}}else{A=function(at){var au="";if(document.selection.createRange){var ar=document.selection.createRange();au=ar.text}return au}}window.tb_position=function(){if(!window.TB_WIDTH||!window.TB_HEIGHT){return}jQuery("#TB_window").css({marginTop:"-"+parseInt((TB_HEIGHT/2),10)+"px",marginLeft:"-"+parseInt((TB_WIDTH/2),10)+"px",width:TB_WIDTH+"px"})};ak()});